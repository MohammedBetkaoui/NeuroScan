{% extends "base_dashboard.html" %}

{% block title %}Modifier Patient - NeuroScan{% endblock %}
{% block page_title %}Modifier les informations du patient{% endblock %}
{% block page_subtitle %}Mise à jour du dossier{% endblock %}
{% block page_description %}Page dédiée pour modifier les informations d'un patient{% endblock %}

{% block secondary_nav %}
<div class="dashboard-nav mb-8">
  <a href="{{ url_for('dashboard') }}" class="dashboard-nav-item">
    <i class="fas fa-home mr-2"></i>Accueil
  </a>
  <a href="{{ url_for('patients_list') }}" class="dashboard-nav-item">
    <i class="fas fa-users mr-2"></i>Mes Patients
  </a>
  <a href="{{ url_for('manage_patients_page') }}" class="dashboard-nav-item">
    <i class="fas fa-users-cog mr-2"></i>Gestion
  </a>
  <span class="dashboard-nav-item active">
    <i class="fas fa-user-edit mr-2"></i>Modifier
  </span>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/edit_patient.css') }}">
{% endblock %}

{% block content %}
<div id="editPage" data-patient-id="{{ patient_id }}" class="dashboard-card p-6 max-w-4xl mx-auto">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-3">
      <div class="section-icon"><i class="fas fa-user-edit"></i></div>
      <div>
        <div class="font-bold text-lg">Modifier le patient</div>
        <div class="hint">ID Patient: <span id="patientIdTxt">{{ patient_id }}</span></div>
      </div>
    </div>
    <span class="chip"><i class="fas fa-history"></i> Suivi des modifications</span>
  </div>

  <form id="editPatientForm" class="space-y-5">
    <div class="form-sections">
      <div class="form-section-card">
        <div class="section-header"><div class="section-icon"><i class="fas fa-user"></i></div><div class="section-title">Informations de base</div></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label">Nom Complet</label>
            <input type="text" class="form-input" id="patient_name" name="patient_name" required />
          </div>
          <div>
            <label class="form-label">Date de Naissance</label>
            <input type="date" class="form-input" id="date_of_birth" name="date_of_birth" max="" />
            <p id="dobHelp" class="help"></p>
          </div>
          <div>
            <label class="form-label">Genre</label>
            <select class="form-input" id="gender" name="gender">
              <option value="">Sélectionner...</option>
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
              <option value="Autre">Autre</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <div class="section-header"><div class="section-icon"><i class="fas fa-address-book"></i></div><div class="section-title">Coordonnées</div></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label">Téléphone</label>
            <input type="tel" class="form-input" id="phone" name="phone" />
            <p id="phoneHelp" class="help"></p>
          </div>
          <div>
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="email" name="email" />
            <p id="emailHelp" class="help"></p>
          </div>
          <div class="md:col-span-2">
            <label class="form-label">Adresse</label>
            <textarea class="form-input" id="address" name="address" rows="2"></textarea>
          </div>
        </div>
      </div>

      <div class="form-section-card">
        <div class="section-header"><div class="section-icon"><i class="fas fa-stethoscope"></i></div><div class="section-title">Dossier médical</div></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label">Contact d'Urgence</label>
            <input type="text" class="form-input" id="emergency_contact_name" name="emergency_contact_name" />
          </div>
          <div>
            <label class="form-label">Téléphone d'Urgence</label>
            <input type="tel" class="form-input" id="emergency_contact_phone" name="emergency_contact_phone" />
          </div>
          <div>
            <label class="form-label">Antécédents Médicaux</label>
            <div><span class="counter" id="medicalHistoryCounter">0/600</span></div>
            <textarea class="form-input" id="medical_history" name="medical_history" rows="3" maxlength="600" data-max="600"></textarea>
          </div>
          <div>
            <label class="form-label">Allergies</label>
            <textarea class="form-input" id="allergies" name="allergies" rows="3"></textarea>
          </div>
          <div>
            <label class="form-label">Médicaments Actuels</label>
            <div><span class="counter" id="currentMedicationsCounter">0/400</span></div>
            <textarea class="form-input" id="current_medications" name="current_medications" rows="3" maxlength="400" data-max="400"></textarea>
          </div>
          <div>
            <label class="form-label">Notes</label>
            <div><span class="counter" id="notesCounter">0/400</span></div>
            <textarea class="form-input" id="notes" name="notes" rows="3" maxlength="400" data-max="400"></textarea>
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-between items-center pt-4 border-t border-gray-100">
  <a href="{{ url_for('manage_patients_page') }}" class="btn-dashboard secondary"><i class="fas fa-arrow-left"></i> Annuler</a>
  <button type="submit" id="submitBtn" class="btn-dashboard success"><i class="fas fa-save"></i> Enregistrer</button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/edit_patient.js') }}"></script>
{% endblock %}
