<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroScan Pro - Tableau de Bord Avancé</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind.build.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --blue-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --green-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --purple-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --orange-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-heavy: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        .slide-in-right {
            animation: slideInRight 0.6s ease-out;
        }

        /* Cards modernes */
        .modern-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .modern-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-heavy);
        }

        /* Stat cards avec gradients modernes */
        .stat-card {
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            z-index: 1;
        }

        .stat-card > * {
            position: relative;
            z-index: 2;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-heavy);
        }

        .stat-card.blue {
            background: var(--blue-gradient);
        }

        .stat-card.green {
            background: var(--green-gradient);
        }

        .stat-card.purple {
            background: var(--purple-gradient);
        }

        .stat-card.orange {
            background: var(--orange-gradient);
        }

        /* Header moderne */
        .modern-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: var(--shadow-light);
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            padding: 20px;
        }

        .chart-container canvas {
            position: absolute;
            top: 20px;
            left: 20px;
            width: calc(100% - 40px) !important;
            height: calc(100% - 40px) !important;
        }

        /* Alerts modernes */
        .alert-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }
        .alert-info {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .alert-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        /* Panel de filtres moderne */
        .filter-panel {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Cartes de filtres modernes */
        .filter-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .filter-card:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-4px);
        }

        .filter-input {
            transition: var(--transition);
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
        }

        .filter-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
            background: white;
        }

        .filter-badge {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: var(--shadow-light);
            transition: var(--transition);
        }

        .filter-badge:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .filter-active {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        /* Range sliders modernes */
        .range-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #e5e7eb 0%, #e5e7eb 100%);
            outline: none;
            transition: var(--transition);
        }

        .range-slider:hover {
            background: linear-gradient(to right, #d1d5db 0%, #d1d5db 100%);
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
        }

        .range-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
            transition: var(--transition);
        }

        .range-slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
        }

        /* Boutons modernes */
        .modern-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
        }

        .modern-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .modern-btn.secondary {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }

        .modern-btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .modern-btn.outline {
            background: transparent;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }

        .modern-btn.outline:hover {
            background: #3b82f6;
            color: white;
        }

        /* Quick buttons */
        .quick-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.75rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .quick-btn:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }

        /* Table moderne */
        .modern-table {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .modern-table thead {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        }

        .modern-table tbody tr {
            transition: var(--transition);
        }

        .modern-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
            transform: scale(1.01);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .chart-container {
                height: 280px;
                padding: 10px;
            }

            .stat-card {
                margin-bottom: 1rem;
            }

            .filter-card {
                margin-bottom: 1rem;
            }
        }

        /* Period buttons */
        .comparison-period-btn, .trend-period-btn {
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: 500;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .comparison-period-btn.active, .trend-period-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: var(--shadow-light);
        }

        .comparison-period-btn:not(.active), .trend-period-btn:not(.active) {
            background: rgba(255, 255, 255, 0.8);
            color: #6b7280;
            border-color: rgba(0, 0, 0, 0.1);
        }

        .comparison-period-btn:not(.active):hover, .trend-period-btn:not(.active):hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }

        /* Scrollbar personnalisée */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        /* Header unifié pour correspondre aux autres pages */
        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: var(--shadow-light);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
            margin-right: 0.75rem;
        }

        .notifications-btn {
            position: relative;
            padding: 0.5rem;
            color: #6b7280;
            border-radius: 0.5rem;
            transition: var(--transition);
        }

        .notifications-btn:hover {
            color: #4f46e5;
            background-color: rgba(79, 70, 229, 0.1);
        }

        .notifications-badge {
            position: absolute;
            top: -0.25rem;
            right: -0.25rem;
            background-color: #ef4444;
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            border-radius: 9999px;
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Navigation principale */
        nav a {
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: var(--transition);
        }

        nav a:hover {
            background-color: rgba(107, 114, 128, 0.1);
            color: #374151;
        }

        nav a.active {
            background-color: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
        }

        /* Dropdowns uniformes */
        .dropdown-menu {
            position: absolute;
            right: 0;
            margin-top: 0.5rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 50;
            overflow: hidden;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #374151;
            transition: var(--transition);
        }

        .dropdown-item:hover {
            background-color: #f9fafb;
        }

        .dropdown-item.danger {
            color: #dc2626;
        }

        .dropdown-item.danger:hover {
            background-color: #fef2f2;
        }

        /* Animation pour les dropdowns */
        .dropdown-menu.hidden {
            opacity: 0;
            transform: translateY(-10px) scale(0.95);
            pointer-events: none;
        }

        .dropdown-menu {
            opacity: 1;
            transform: translateY(0) scale(1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Responsive navbar */
        @media (max-width: 768px) {
            .logo-container h1 {
                font-size: 1.125rem;
            }
            
            .logo-container p {
                display: none;
            }
            
            nav {
                display: none;
            }
            
            .user-menu > div:not(:last-child) {
                display: none;
            }
        }

        /* Badge d'alerte avec animation */
        .notifications-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="bg-gray-50 antialiased">
    <!-- Header unifié -->
    <header class="dashboard-header sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo et navigation -->
                <div class="flex items-center space-x-8">
                    <!-- Logo -->
                    <div class="logo-container">
                        <div class="logo-icon">
                            <i class="fas fa-brain text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900">NeuroScan</h1>
                            <p class="text-xs text-gray-500">Tableau de bord avancé</p>
                        </div>
                    </div>
                    
                    <!-- Navigation principale -->
                    <nav class="hidden md:flex space-x-4">
                        <a href="/dashboard" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors">
                            <i class="fas fa-home mr-2"></i>Accueil
                        </a>
                        <a href="/pro-dashboard" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors">
                            <i class="fas fa-chart-line mr-2"></i>Statistiques
                        </a>
                        <a href="/pro-dashboard-advanced" class="px-3 py-2 text-sm font-medium text-indigo-600 bg-indigo-100 rounded-md">
                            <i class="fas fa-analytics mr-2"></i>Avancé
                        </a>
                    </nav>
                </div>

                <!-- Menu utilisateur -->
                <div class="user-menu">
                    <!-- Filters Toggle -->
                    <button id="toggleFilters" class="modern-btn secondary relative">
                        <i class="fas fa-filter mr-2"></i>
                        <span class="hidden sm:inline">Filtres</span>
                        <span id="activeFiltersCount" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold shadow-lg">0</span>
                    </button>

                    <!-- Export Dropdown -->
                    <div class="relative">
                        <button id="exportBtn" class="modern-btn">
                            <i class="fas fa-download mr-2"></i>
                            <span class="hidden sm:inline">Export</span>
                            <i class="fas fa-chevron-down ml-2 text-xs"></i>
                        </button>
                        <div id="exportMenu" class="hidden absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-100 z-20 overflow-hidden">
                            <div class="py-2">
                                <a href="/api/analytics/export/csv" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-file-csv text-green-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">Exporter CSV</div>
                                        <div class="text-xs text-gray-500">Données tabulaires</div>
                                    </div>
                                </a>
                                <a href="/api/analytics/export/json" class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-file-code text-blue-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">Exporter JSON</div>
                                        <div class="text-xs text-gray-500">Format structuré</div>
                                    </div>
                                </a>
                                <div class="border-t border-gray-100 my-1"></div>
                                <button onclick="exportToPDF()" class="flex items-center w-full px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                    <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-file-pdf text-red-600"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">Rapport PDF</div>
                                        <div class="text-xs text-gray-500">Rapport complet</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications et alertes -->
                    <div class="relative">
                        <button id="alertsButton" class="notifications-btn">
                            <i class="fas fa-bell text-lg"></i>
                            <span id="alertsBadge" class="notifications-badge hidden">0</span>
                        </button>
                        
                        <!-- Dropdown des alertes -->
                        <div id="alertsDropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-50">
                            <div class="p-4 border-b border-gray-100">
                                <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                                    <i class="fas fa-exclamation-triangle text-amber-500 mr-2"></i>
                                    Alertes Système
                                </h3>
                            </div>
                            <div id="alertsList" class="max-h-96 overflow-y-auto">
                                <!-- Alertes chargées dynamiquement -->
                            </div>
                            <div class="p-3 border-t border-gray-100 text-center">
                                <button onclick="clearAllAlerts()" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                                    Marquer tout comme lu
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Informations utilisateur -->
                    <div class="hidden md:block text-right">
                        <p class="text-sm font-medium text-gray-900">Tableau de bord</p>
                        <p class="text-xs text-gray-500">Analytics avancées</p>
                    </div>
                    
                    <!-- Avatar et menu -->
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 rounded-lg p-1">
                            <div class="w-8 h-8 bg-gradient-to-r from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-md text-white text-sm"></i>
                            </div>
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        
                        <!-- Dropdown menu utilisateur -->
                        <div id="userMenuDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50">
                            <div class="p-2">
                                <a href="/dashboard" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md">
                                    <i class="fas fa-home mr-3"></i>Tableau de bord
                                </a>
                                <a href="/pro-dashboard" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md">
                                    <i class="fas fa-chart-line mr-3"></i>Statistiques
                                </a>
                                <a href="/patients" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md">
                                    <i class="fas fa-users mr-3"></i>Mes Patients
                                </a>
                                <hr class="my-2 border-gray-100">
                                <a href="#" onclick="openProfileModal()" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md">
                                    <i class="fas fa-user-cog mr-3"></i>Mon Profil
                                </a>
                                <a href="#" onclick="openSettingsModal()" class="flex items-center px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md">
                                    <i class="fas fa-cog mr-3"></i>Paramètres
                                </a>
                                <hr class="my-2 border-gray-100">
                                <a href="/logout" class="flex items-center px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md">
                                    <i class="fas fa-sign-out-alt mr-3"></i>Déconnexion
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Advanced Filters Panel -->
    <div id="filtersPanel" class="hidden filter-panel">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Filter Header -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-8 space-y-4 sm:space-y-0">
                <div class="fade-in-up">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">
                        <i class="fas fa-sliders-h mr-3 text-blue-600"></i>
                        Filtres Avancés
                    </h3>
                    <p class="text-gray-600">Affinez vos recherches avec des critères précis et obtenez des insights détaillés</p>
                </div>
                <div class="flex items-center space-x-3 slide-in-right">
                    <button id="resetFilters" class="modern-btn outline text-red-600 border-red-600 hover:bg-red-600 hover:text-white">
                        <i class="fas fa-undo mr-2"></i>Réinitialiser
                    </button>
                    <button id="saveFilters" class="modern-btn success">
                        <i class="fas fa-bookmark mr-2"></i>Sauvegarder
                    </button>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="activeFilters" class="mb-6 hidden fade-in-up">
                <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-gray-200">
                    <div class="flex flex-wrap items-center gap-3">
                        <span class="text-sm font-semibold text-gray-700 flex items-center">
                            <i class="fas fa-filter mr-2 text-blue-600"></i>
                            Filtres actifs:
                        </span>
                        <div id="activeFiltersList" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>
            </div>

            <!-- Filter Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

                <!-- Date Range Filter -->
                <div class="filter-card p-6 fade-in-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-calendar-alt text-blue-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-900">Période</h4>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date de début</label>
                            <input type="date" id="startDate" class="filter-input w-full px-4 py-3 text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date de fin</label>
                            <input type="date" id="endDate" class="filter-input w-full px-4 py-3 text-sm">
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button class="quick-btn quick-date-btn" data-days="7">7 jours</button>
                            <button class="quick-btn quick-date-btn" data-days="30">30 jours</button>
                            <button class="quick-btn quick-date-btn" data-days="90">90 jours</button>
                        </div>
                    </div>
                </div>

                <!-- Diagnostic Type Filter -->
                <div class="filter-card p-6 fade-in-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-brain text-green-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-900">Diagnostics</h4>
                    </div>
                    <div class="space-y-3">
                        <label class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                            <input type="checkbox" class="diagnostic-checkbox mr-3 w-4 h-4 text-blue-600 rounded" value="Normal">
                            <div class="flex-1">
                                <span class="text-sm font-medium text-gray-900">Normal</span>
                            </div>
                            <span class="text-xs font-semibold text-green-600 bg-green-100 px-2 py-1 rounded-full" id="count-Normal">0</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                            <input type="checkbox" class="diagnostic-checkbox mr-3 w-4 h-4 text-blue-600 rounded" value="Gliome">
                            <div class="flex-1">
                                <span class="text-sm font-medium text-gray-900">Gliome</span>
                            </div>
                            <span class="text-xs font-semibold text-red-600 bg-red-100 px-2 py-1 rounded-full" id="count-Gliome">0</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                            <input type="checkbox" class="diagnostic-checkbox mr-3 w-4 h-4 text-blue-600 rounded" value="Méningiome">
                            <div class="flex-1">
                                <span class="text-sm font-medium text-gray-900">Méningiome</span>
                            </div>
                            <span class="text-xs font-semibold text-yellow-600 bg-yellow-100 px-2 py-1 rounded-full" id="count-Méningiome">0</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                            <input type="checkbox" class="diagnostic-checkbox mr-3 w-4 h-4 text-blue-600 rounded" value="Tumeur pituitaire">
                            <div class="flex-1">
                                <span class="text-sm font-medium text-gray-900">Tumeur pituitaire</span>
                            </div>
                            <span class="text-xs font-semibold text-purple-600 bg-purple-100 px-2 py-1 rounded-full" id="count-Tumeur pituitaire">0</span>
                        </label>
                    </div>
                </div>

                <!-- Confidence Range Filter -->
                <div class="filter-card p-6 fade-in-up" style="animation-delay: 0.3s;">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-chart-line text-purple-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-900">Confiance</h4>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Confiance minimale: <span id="minConfidenceValue" class="text-purple-600 font-bold text-lg">0%</span>
                            </label>
                            <input type="range" id="minConfidence" min="0" max="100" value="0"
                                   class="range-slider w-full">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0%</span>
                                <span>50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Confiance maximale: <span id="maxConfidenceValue" class="text-purple-600 font-bold text-lg">100%</span>
                            </label>
                            <input type="range" id="maxConfidence" min="0" max="100" value="100"
                                   class="range-slider w-full">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0%</span>
                                <span>50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing Time Filter -->
                <div class="filter-card p-6 fade-in-up" style="animation-delay: 0.4s;">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center mr-3">
                            <i class="fas fa-clock text-orange-600"></i>
                        </div>
                        <h4 class="font-semibold text-gray-900">Temps de traitement</h4>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Temps maximum: <span id="maxTimeValue" class="text-orange-600 font-bold text-lg">10s</span>
                            </label>
                            <input type="range" id="maxProcessingTime" min="0" max="10" value="10" step="0.1"
                                   class="range-slider w-full">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>0s</span>
                                <span>5s</span>
                                <span>10s</span>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button class="quick-btn quick-time-btn" data-time="1">< 1s</button>
                            <button class="quick-btn quick-time-btn" data-time="3">< 3s</button>
                            <button class="quick-btn quick-time-btn" data-time="5">< 5s</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mt-8 pt-6 border-t border-gray-200 space-y-4 sm:space-y-0">
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                    <span id="filterResultsPreview" class="text-sm text-gray-600 font-medium">
                        Configurez vos filtres et cliquez sur "Appliquer" pour voir les résultats
                    </span>
                </div>
                <div class="flex space-x-3">
                    <button id="previewFilters" class="modern-btn outline">
                        <i class="fas fa-eye mr-2"></i>Aperçu
                    </button>
                    <button id="applyFilters" class="modern-btn">
                        <i class="fas fa-search mr-2"></i>Appliquer les filtres
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Alerts Section -->
        <div id="alertsSection" class="mb-8">
            <!-- Alerts will be loaded here -->
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Analyses -->
            <div class="stat-card blue text-white p-6 fade-in-up" style="animation-delay: 0.1s;">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-chart-line text-lg mr-2 opacity-80"></i>
                            <p class="text-blue-100 text-sm font-medium uppercase tracking-wide">Total Analyses</p>
                        </div>
                        <p id="totalAnalyses" class="text-4xl font-bold mb-1">-</p>
                        <div class="flex items-center text-blue-200 text-xs">
                            <i class="fas fa-arrow-up mr-1"></i>
                            <span id="totalChange">+0%</span>
                            <span class="ml-1">ce mois</span>
                        </div>
                    </div>
                    <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                        <i class="fas fa-brain text-3xl"></i>
                    </div>
                </div>
            </div>

            <!-- Confiance Moyenne -->
            <div class="stat-card green text-white p-6 fade-in-up" style="animation-delay: 0.2s;">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-check-circle text-lg mr-2 opacity-80"></i>
                            <p class="text-green-100 text-sm font-medium uppercase tracking-wide">Confiance Moyenne</p>
                        </div>
                        <p id="avgConfidence" class="text-4xl font-bold mb-1">-%</p>
                        <div class="flex items-center text-green-200 text-xs">
                            <i class="fas fa-shield-alt mr-1"></i>
                            <span id="confidenceChange">Fiabilité élevée</span>
                        </div>
                    </div>
                    <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                        <i class="fas fa-award text-3xl"></i>
                    </div>
                </div>
            </div>

            <!-- Analyses Aujourd'hui -->
            <div class="stat-card purple text-white p-6 fade-in-up" style="animation-delay: 0.3s;">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-calendar-day text-lg mr-2 opacity-80"></i>
                            <p class="text-purple-100 text-sm font-medium uppercase tracking-wide">Aujourd'hui</p>
                        </div>
                        <p id="todayAnalyses" class="text-4xl font-bold mb-1">-</p>
                        <div class="flex items-center text-purple-200 text-xs">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="todayChange">Activité du jour</span>
                        </div>
                    </div>
                    <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                        <i class="fas fa-calendar-check text-3xl"></i>
                    </div>
                </div>
            </div>

            <!-- Temps Moyen -->
            <div class="stat-card orange text-white p-6 fade-in-up" style="animation-delay: 0.4s;">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-clock text-lg mr-2 opacity-80"></i>
                            <p class="text-orange-100 text-sm font-medium uppercase tracking-wide">Temps Moyen</p>
                        </div>
                        <p id="avgProcessingTime" class="text-4xl font-bold mb-1">-s</p>
                        <div class="flex items-center text-orange-200 text-xs">
                            <i class="fas fa-tachometer-alt mr-1"></i>
                            <span id="timeChange">Performance optimale</span>
                        </div>
                    </div>
                    <div class="bg-white bg-opacity-20 p-4 rounded-2xl">
                        <i class="fas fa-stopwatch text-3xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
            <!-- Comparison Chart -->
            <div class="xl:col-span-2 modern-card p-6 fade-in-up" style="animation-delay: 0.5s;">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 space-y-4 sm:space-y-0">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Comparaison Temporelle</h3>
                        <p class="text-gray-600 text-sm">Analyse comparative des performances</p>
                    </div>
                    <div class="flex space-x-2 bg-gray-100 p-1 rounded-xl">
                        <button class="comparison-period-btn active text-sm px-3 py-2 rounded-lg transition-all" data-period="day">
                            <i class="fas fa-clock mr-1"></i>Jour
                        </button>
                        <button class="comparison-period-btn text-sm px-3 py-2 rounded-lg transition-all" data-period="week">
                            <i class="fas fa-calendar-week mr-1"></i>Semaine
                        </button>
                        <button class="comparison-period-btn text-sm px-3 py-2 rounded-lg transition-all" data-period="month">
                            <i class="fas fa-calendar mr-1"></i>Mois
                        </button>
                    </div>
                </div>
                <div class="chart-container relative">
                    <canvas id="comparisonChart"></canvas>
                    <div id="comparisonChartLoader" class="absolute inset-0 flex items-center justify-center hidden">
                        <div class="bg-white rounded-lg p-4 shadow-lg">
                            <i class="fas fa-spinner fa-spin text-indigo-600 mr-2"></i>
                            <span class="text-gray-700">Chargement...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Trends -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 0.6s;">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Performance</h3>
                    <p class="text-gray-600 text-sm">Tendances de performance</p>
                </div>
                <div class="chart-container relative">
                    <canvas id="performanceChart"></canvas>
                    <div id="performanceChartLoader" class="absolute inset-0 flex items-center justify-center hidden">
                        <div class="bg-white rounded-lg p-4 shadow-lg">
                            <i class="fas fa-spinner fa-spin text-indigo-600 mr-2"></i>
                            <span class="text-gray-700">Chargement...</span>
                        </div>
                    </div>
                </div>
                <!-- Métriques de performance -->
                <div id="performanceMetrics" class="mt-4 space-y-3">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Temps moyen</span>
                        <span class="text-sm font-bold text-blue-600" id="avgTime">-</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Pic de performance</span>
                        <span class="text-sm font-bold text-green-600" id="peakTime">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Diagnostic Distribution -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 0.7s;">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Distribution des Diagnostics</h3>
                        <p class="text-gray-600 text-sm">Répartition par type de diagnostic</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="modern-btn outline text-sm" onclick="exportDiagnosticData()">
                            <i class="fas fa-download mr-1"></i>Export
                        </button>
                    </div>
                </div>
                <div class="chart-container relative">
                    <canvas id="diagnosticDistributionChart"></canvas>
                </div>
                <!-- Legend avec statistiques -->
                <div id="diagnosticLegend" class="mt-4 grid grid-cols-2 gap-3">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                            <span class="text-sm font-medium text-gray-700">Normal</span>
                        </div>
                        <span class="text-sm font-bold text-gray-900" id="normalCount">-</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                            <span class="text-sm font-medium text-gray-700">Gliome</span>
                        </div>
                        <span class="text-sm font-bold text-gray-900" id="gliomeCount">-</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                            <span class="text-sm font-medium text-gray-700">Méningiome</span>
                        </div>
                        <span class="text-sm font-bold text-gray-900" id="meningiomeCount">-</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                            <span class="text-sm font-medium text-gray-700">Tumeur pituitaire</span>
                        </div>
                        <span class="text-sm font-bold text-gray-900" id="pituitaireCount">-</span>
                    </div>
                </div>
            </div>

            <!-- Hourly Activity Heatmap -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 0.8s;">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Activité par Heure</h3>
                        <p class="text-gray-600 text-sm">Heatmap d'activité sur 24h</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="modern-btn outline text-sm" onclick="changeHeatmapView('today')">
                            <i class="fas fa-calendar-day mr-1"></i>Aujourd'hui
                        </button>
                        <button class="modern-btn outline text-sm" onclick="changeHeatmapView('week')">
                            <i class="fas fa-calendar-week mr-1"></i>7 jours
                        </button>
                    </div>
                </div>
                <div class="chart-container relative">
                    <canvas id="hourlyHeatmapChart"></canvas>
                </div>
                <!-- Peak Hours -->
                <div class="mt-4 grid grid-cols-3 gap-3">
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <div class="text-sm text-gray-600">Heure de pointe</div>
                        <div class="text-lg font-bold text-blue-600" id="peakHour">-</div>
                    </div>
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                        <div class="text-sm text-gray-600">Max analyses/h</div>
                        <div class="text-lg font-bold text-green-600" id="maxHourlyAnalyses">-</div>
                    </div>
                    <div class="text-center p-3 bg-purple-50 rounded-lg">
                        <div class="text-sm text-gray-600">Heure calme</div>
                        <div class="text-lg font-bold text-purple-600" id="quietHour">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quality & Confidence Analysis -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-8">
            <!-- Confidence Distribution -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 0.9s;">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Distribution Confiance</h3>
                    <p class="text-gray-600 text-sm">Répartition des niveaux de confiance</p>
                </div>
                <div class="chart-container relative">
                    <canvas id="confidenceHistogramChart"></canvas>
                </div>
                <!-- Confidence Stats -->
                <div class="mt-4 space-y-2">
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Très haute (90-100%)</span>
                        <span class="font-bold text-green-600" id="veryHighConf">-</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Haute (80-89%)</span>
                        <span class="font-bold text-blue-600" id="highConf">-</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Moyenne (70-79%)</span>
                        <span class="font-bold text-yellow-600" id="mediumConf">-</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">Faible (<70%)</span>
                        <span class="font-bold text-red-600" id="lowConf">-</span>
                    </div>
                </div>
            </div>

            <!-- Processing Time Analysis -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 1.0s;">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Temps de Traitement</h3>
                    <p class="text-gray-600 text-sm">Analyse des temps de réponse</p>
                </div>
                <div class="chart-container relative">
                    <canvas id="processingTimeChart"></canvas>
                </div>
                <!-- Time Stats -->
                <div class="mt-4 grid grid-cols-2 gap-3">
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                        <div class="text-sm text-gray-600">Rapide (<2s)</div>
                        <div class="text-lg font-bold text-green-600" id="fastProcessing">-</div>
                    </div>
                    <div class="text-center p-3 bg-yellow-50 rounded-lg">
                        <div class="text-sm text-gray-600">Normal (2-5s)</div>
                        <div class="text-lg font-bold text-yellow-600" id="normalProcessing">-</div>
                    </div>
                    <div class="text-center p-3 bg-red-50 rounded-lg">
                        <div class="text-sm text-gray-600">Lent (>5s)</div>
                        <div class="text-lg font-bold text-red-600" id="slowProcessing">-</div>
                    </div>
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <div class="text-sm text-gray-600">Médiane</div>
                        <div class="text-lg font-bold text-blue-600" id="medianTime">-</div>
                    </div>
                </div>
            </div>

            <!-- Monthly Trends -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 1.1s;">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">Tendances Mensuelles</h3>
                    <p class="text-gray-600 text-sm">Évolution sur 12 mois</p>
                </div>
                <div class="chart-container relative">
                    <canvas id="monthlyTrendsChart"></canvas>
                </div>
                <!-- Trend Insights -->
                <div class="mt-4 space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Croissance mensuelle</span>
                        <span class="text-sm font-bold text-blue-600" id="monthlyGrowth">-</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Mois le plus actif</span>
                        <span class="text-sm font-bold text-green-600" id="mostActiveMonth">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights & Recommendations -->
        <div class="modern-card p-6 mb-8 fade-in-up" style="animation-delay: 1.2s;">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-1">
                        <i class="fas fa-brain text-indigo-600 mr-3"></i>
                        Insights & Recommandations IA
                    </h3>
                    <p class="text-gray-600 text-sm">Analyses intelligentes et suggestions d'amélioration</p>
                </div>
                <div class="flex space-x-2">
                    <button class="modern-btn outline text-sm" onclick="refreshInsights()">
                        <i class="fas fa-sync-alt mr-1"></i>Actualiser
                    </button>
                    <button class="modern-btn text-sm" onclick="exportInsights()">
                        <i class="fas fa-file-pdf mr-1"></i>Rapport
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Performance Insights -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-100 p-6 rounded-xl border border-blue-200">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">Performance</h4>
                            <p class="text-sm text-gray-600">Analyse des tendances</p>
                        </div>
                    </div>
                    <div id="performanceInsights" class="space-y-3">
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-circle text-blue-500 text-xs mr-2"></i>
                                <span class="text-gray-700">Chargement des insights...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quality Insights -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-100 p-6 rounded-xl border border-green-200">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-award text-white text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">Qualité</h4>
                            <p class="text-sm text-gray-600">Évaluation de la précision</p>
                        </div>
                    </div>
                    <div id="qualityInsights" class="space-y-3">
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-circle text-green-500 text-xs mr-2"></i>
                                <span class="text-gray-700">Chargement des insights...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="bg-gradient-to-br from-purple-50 to-violet-100 p-6 rounded-xl border border-purple-200">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-lightbulb text-white text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-800">Recommandations</h4>
                            <p class="text-sm text-gray-600">Suggestions d'amélioration</p>
                        </div>
                    </div>
                    <div id="recommendationsInsights" class="space-y-3">
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-circle text-purple-500 text-xs mr-2"></i>
                                <span class="text-gray-700">Chargement des insights...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Metrics Summary -->
            <div class="mt-8 grid grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <div class="text-2xl font-bold text-blue-600" id="accuracyScore">-</div>
                    <div class="text-sm text-gray-600">Score de Précision</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <div class="text-2xl font-bold text-green-600" id="efficiencyScore">-</div>
                    <div class="text-sm text-gray-600">Efficacité</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <div class="text-2xl font-bold text-orange-600" id="reliabilityScore">-</div>
                    <div class="text-sm text-gray-600">Fiabilité</div>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <div class="text-2xl font-bold text-purple-600" id="overallScore">-</div>
                    <div class="text-sm text-gray-600">Score Global</div>
                </div>
            </div>
        </div>

        <!-- Filtered Results Table -->
        <div id="filteredResults" class="modern-card fade-in-up" style="animation-delay: 1.3s;">
            <div class="p-6 border-b border-gray-100">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Analyses Filtrées</h3>
                        <p class="text-gray-600 text-sm">Résultats correspondant à vos critères de recherche</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="filteredCount" class="text-sm font-semibold text-gray-700 bg-gray-100 px-3 py-1 rounded-full">0 résultats</span>
                        <div class="flex space-x-2">
                            <button onclick="exportFilteredResults()" class="modern-btn outline text-sm">
                                <i class="fas fa-download mr-2"></i>Exporter
                            </button>
                            <button onclick="refreshFilteredResults()" class="modern-btn success text-sm">
                                <i class="fas fa-sync-alt mr-2"></i>Actualiser
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full modern-table">
                    <thead>
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-clock mr-2"></i>Date/Heure
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-file-medical mr-2"></i>Fichier
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-stethoscope mr-2"></i>Diagnostic
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-percentage mr-2"></i>Confiance
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-stopwatch mr-2"></i>Temps
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                                <i class="fas fa-info-circle mr-2"></i>Description
                            </th>
                        </tr>
                    </thead>
                    <tbody id="filteredAnalysesTable" class="bg-white divide-y divide-gray-100">
                        <!-- État initial -->
                        <tr id="initialState">
                            <td colspan="6" class="px-6 py-12 text-center">
                                <div class="flex flex-col items-center space-y-4">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-filter text-blue-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-900 mb-1">Aucun filtre appliqué</h3>
                                        <p class="text-gray-500">Configurez vos filtres et cliquez sur "Appliquer" pour voir les résultats</p>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Advanced Comparison & Predictions -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
            <!-- Year-over-Year Comparison -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 1.4s;">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Comparaison Annuelle</h3>
                        <p class="text-gray-600 text-sm">Évolution sur les 12 derniers mois</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="modern-btn outline text-sm" onclick="toggleYearComparison()">
                            <i class="fas fa-exchange-alt mr-1"></i>Comparer
                        </button>
                    </div>
                </div>
                <div class="chart-container relative">
                    <canvas id="yearComparisonChart"></canvas>
                </div>
                <div class="mt-4 grid grid-cols-3 gap-3">
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <div class="text-sm text-gray-600">Croissance</div>
                        <div class="text-lg font-bold text-blue-600" id="yearGrowth">-</div>
                    </div>
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                        <div class="text-sm text-gray-600">Prédiction</div>
                        <div class="text-lg font-bold text-green-600" id="nextMonthPrediction">-</div>
                    </div>
                    <div class="text-center p-3 bg-purple-50 rounded-lg">
                        <div class="text-sm text-gray-600">Tendance</div>
                        <div class="text-lg font-bold text-purple-600" id="trendDirection">-</div>
                    </div>
                </div>
            </div>

            <!-- Advanced Metrics Dashboard -->
            <div class="modern-card p-6 fade-in-up" style="animation-delay: 1.5s;">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-1">Métriques Avancées</h3>
                        <p class="text-gray-600 text-sm">Indicateurs de performance clés</p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-analytics text-white text-xl"></i>
                    </div>
                </div>
                
                <!-- KPI Grid -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-blue-600" id="throughputRate">-</div>
                                <div class="text-sm text-blue-700">Analyses/jour</div>
                            </div>
                            <i class="fas fa-tachometer-alt text-blue-500 text-2xl"></i>
                        </div>
                        <div class="mt-2 flex items-center text-xs">
                            <i class="fas fa-arrow-up text-green-500 mr-1"></i>
                            <span class="text-green-600 font-medium" id="throughputChange">+0%</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl border border-green-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-green-600" id="accuracyRate">-</div>
                                <div class="text-sm text-green-700">Précision</div>
                            </div>
                            <i class="fas fa-bullseye text-green-500 text-2xl"></i>
                        </div>
                        <div class="mt-2 flex items-center text-xs">
                            <i class="fas fa-shield-alt text-blue-500 mr-1"></i>
                            <span class="text-gray-600">Fiabilité élevée</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-xl border border-orange-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-orange-600" id="avgResponseTime">-</div>
                                <div class="text-sm text-orange-700">Temps moyen</div>
                            </div>
                            <i class="fas fa-stopwatch text-orange-500 text-2xl"></i>
                        </div>
                        <div class="mt-2 flex items-center text-xs">
                            <i class="fas fa-clock text-orange-500 mr-1"></i>
                            <span class="text-orange-600 font-medium" id="responseTimeStatus">Optimal</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl border border-purple-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-2xl font-bold text-purple-600" id="systemUptime">-</div>
                                <div class="text-sm text-purple-700">Disponibilité</div>
                            </div>
                            <i class="fas fa-server text-purple-500 text-2xl"></i>
                        </div>
                        <div class="mt-2 flex items-center text-xs">
                            <i class="fas fa-check-circle text-green-500 mr-1"></i>
                            <span class="text-green-600 font-medium">Système stable</span>
                        </div>
                    </div>
                </div>

                <!-- Performance Indicators -->
                <div class="mt-6 space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Charge système</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 35%" id="systemLoadBar"></div>
                            </div>
                            <span class="text-sm font-bold text-gray-900" id="systemLoad">35%</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="text-sm font-medium text-gray-700">Utilisation modèle</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 78%" id="modelUsageBar"></div>
                            </div>
                            <span class="text-sm font-bold text-gray-900" id="modelUsage">78%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let comparisonChart = null;
        let performanceChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilters();
            loadDashboardData();
            loadAlerts();
            loadComparisons();
            loadPerformanceTrends();
            loadAdvancedAnalytics();
            loadAIInsights();
            loadAdvancedMetrics();

            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadDashboardData();
                loadAlerts();
                loadPerformanceTrends();
                loadAdvancedAnalytics();
                loadAIInsights();
                loadAdvancedMetrics();
            }, 30000);
        });

        // Advanced Filter functionality
        function initializeFilters() {
            const toggleFilters = document.getElementById('toggleFilters');
            const filtersPanel = document.getElementById('filtersPanel');
            const applyFilters = document.getElementById('applyFilters');
            const previewFilters = document.getElementById('previewFilters');
            const resetFilters = document.getElementById('resetFilters');

            // Range sliders
            const minConfidence = document.getElementById('minConfidence');
            const maxConfidence = document.getElementById('maxConfidence');
            const maxProcessingTime = document.getElementById('maxProcessingTime');
            const minConfidenceValue = document.getElementById('minConfidenceValue');
            const maxConfidenceValue = document.getElementById('maxConfidenceValue');
            const maxTimeValue = document.getElementById('maxTimeValue');

            // Toggle filters panel
            toggleFilters?.addEventListener('click', () => {
                filtersPanel.classList.toggle('hidden');
                if (!filtersPanel.classList.contains('hidden')) {
                    loadFilterCounts();
                }
            });

            // Range slider updates
            minConfidence?.addEventListener('input', (e) => {
                minConfidenceValue.textContent = e.target.value + '%';
                updateActiveFilters();
            });

            maxConfidence?.addEventListener('input', (e) => {
                maxConfidenceValue.textContent = e.target.value + '%';
                updateActiveFilters();
            });

            maxProcessingTime?.addEventListener('input', (e) => {
                maxTimeValue.textContent = e.target.value + 's';
                updateActiveFilters();
            });

            // Quick date buttons
            document.querySelectorAll('.quick-date-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const days = parseInt(e.target.dataset.days);
                    const endDate = new Date();
                    const startDate = new Date();
                    startDate.setDate(endDate.getDate() - days);

                    document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
                    document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
                    updateActiveFilters();
                });
            });

            // Quick time buttons
            document.querySelectorAll('.quick-time-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const time = parseFloat(e.target.dataset.time);
                    document.getElementById('maxProcessingTime').value = time;
                    maxTimeValue.textContent = time + 's';
                    updateActiveFilters();
                });
            });

            // Diagnostic checkboxes
            document.querySelectorAll('.diagnostic-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateActiveFilters);
            });

            // Date inputs
            document.getElementById('startDate')?.addEventListener('change', updateActiveFilters);
            document.getElementById('endDate')?.addEventListener('change', updateActiveFilters);

            // Action buttons
            applyFilters?.addEventListener('click', applyFiltersFunction);
            previewFilters?.addEventListener('click', previewFiltersFunction);
            resetFilters?.addEventListener('click', resetFiltersFunction);

            // Export menu
            const exportBtn = document.getElementById('exportBtn');
            const exportMenu = document.getElementById('exportMenu');
            
            exportBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                exportMenu.classList.toggle('hidden');
            });
            
            document.addEventListener('click', () => {
                exportMenu.classList.add('hidden');
            });
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/analytics/overview');
                const data = await response.json();
                
                if (data.success) {
                    updateOverviewStats(data.data);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        async function loadAlerts() {
            try {
                const response = await fetch('/api/analytics/alerts');
                const data = await response.json();
                
                if (data.success) {
                    updateAlertsSection(data.data);
                }
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        async function loadComparisons() {
            try {
                const response = await fetch('/api/analytics/comparison');
                const data = await response.json();

                if (data.success) {
                    updateComparisonChart(data.data);
                }
            } catch (error) {
                console.error('Error loading comparisons:', error);
            }
        }

        async function loadPerformanceTrends() {
            try {
                const response = await fetch('/api/analytics/performance');
                const data = await response.json();

                if (data.success) {
                    updatePerformanceChart(data.data);
                }
            } catch (error) {
                console.error('Error loading performance trends:', error);
            }
        }

        function updateOverviewStats(data) {
            document.getElementById('totalAnalyses').textContent = data.total_analyses;
            document.getElementById('avgConfidence').textContent = data.avg_confidence + '%';
            document.getElementById('avgProcessingTime').textContent = data.avg_processing_time + 's';
            
            // Calculate today's analyses
            const today = new Date().toISOString().split('T')[0];
            const todayData = data.daily_analyses.find(d => d[0] === today);
            document.getElementById('todayAnalyses').textContent = todayData ? todayData[1] : 0;
        }

        function updateAlertsSection(alerts) {
            const alertsSection = document.getElementById('alertsSection');
            
            if (alerts.length === 0) {
                alertsSection.innerHTML = '';
                return;
            }

            const alertsHTML = alerts.map(alert => `
                <div class="alert-${alert.type} text-white p-4 rounded-xl mb-4 flex items-center">
                    <div class="bg-white bg-opacity-20 p-2 rounded-full mr-4">
                        <i class="fas fa-${alert.type === 'warning' ? 'exclamation-triangle' : alert.type === 'info' ? 'info-circle' : 'check-circle'}"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-bold">${alert.title}</h4>
                        <p class="text-sm opacity-90">${alert.message}</p>
                    </div>
                    <div class="text-xs opacity-75">
                        ${new Date(alert.timestamp).toLocaleTimeString('fr-FR')}
                    </div>
                </div>
            `).join('');

            alertsSection.innerHTML = alertsHTML;
        }

        function updateComparisonChart(data) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            // Prepare data for comparison
            const labels = ['Ce mois', 'Mois dernier'];
            const thisMonth = data.monthly['Ce mois']?.count || 0;
            const lastMonth = data.monthly['Mois dernier']?.count || 0;

            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre d\'analyses',
                        data: [thisMonth, lastMonth],
                        backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(156, 163, 175, 0.8)'],
                        borderColor: ['rgb(59, 130, 246)', 'rgb(156, 163, 175)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updatePerformanceChart(data) {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            if (performanceChart) {
                performanceChart.destroy();
            }

            // Utiliser les données quotidiennes des 7 derniers jours
            const dailyTrends = data.daily_trends;

            // Si pas de données quotidiennes, utiliser les données horaires
            const chartData = dailyTrends.labels.length > 0 ? dailyTrends : data.hourly_trends;

            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [
                        {
                            label: 'Confiance (%)',
                            data: chartData.confidence,
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Temps de traitement (s)',
                            data: chartData.processing_time,
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: chartData.labels.length > 10 ? 'Jours' : 'Heures'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Confiance (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Temps (s)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            min: 0
                        }
                    }
                }
            });
        }

        // Update active filters display
        function updateActiveFilters() {
            const activeFilters = [];
            const activeFiltersContainer = document.getElementById('activeFilters');
            const activeFiltersList = document.getElementById('activeFiltersList');
            const activeFiltersCount = document.getElementById('activeFiltersCount');

            // Date filters
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (startDate || endDate) {
                activeFilters.push({
                    type: 'date',
                    label: `Période: ${startDate || '...'} → ${endDate || '...'}`,
                    remove: () => {
                        document.getElementById('startDate').value = '';
                        document.getElementById('endDate').value = '';
                        updateActiveFilters();
                    }
                });
            }

            // Diagnostic filters
            const selectedDiagnostics = Array.from(document.querySelectorAll('.diagnostic-checkbox:checked')).map(cb => cb.value);
            if (selectedDiagnostics.length > 0) {
                activeFilters.push({
                    type: 'diagnostic',
                    label: `Diagnostics: ${selectedDiagnostics.join(', ')}`,
                    remove: () => {
                        document.querySelectorAll('.diagnostic-checkbox').forEach(cb => cb.checked = false);
                        updateActiveFilters();
                    }
                });
            }

            // Confidence filters
            const minConf = document.getElementById('minConfidence').value;
            const maxConf = document.getElementById('maxConfidence').value;
            if (minConf > 0 || maxConf < 100) {
                activeFilters.push({
                    type: 'confidence',
                    label: `Confiance: ${minConf}% - ${maxConf}%`,
                    remove: () => {
                        document.getElementById('minConfidence').value = 0;
                        document.getElementById('maxConfidence').value = 100;
                        document.getElementById('minConfidenceValue').textContent = '0%';
                        document.getElementById('maxConfidenceValue').textContent = '100%';
                        updateActiveFilters();
                    }
                });
            }

            // Processing time filter
            const maxTime = document.getElementById('maxProcessingTime').value;
            if (maxTime < 10) {
                activeFilters.push({
                    type: 'time',
                    label: `Temps max: ${maxTime}s`,
                    remove: () => {
                        document.getElementById('maxProcessingTime').value = 10;
                        document.getElementById('maxTimeValue').textContent = '10s';
                        updateActiveFilters();
                    }
                });
            }

            // Update display
            if (activeFilters.length > 0) {
                activeFiltersContainer.classList.remove('hidden');
                activeFiltersCount.classList.remove('hidden');
                activeFiltersCount.textContent = activeFilters.length;

                activeFiltersList.innerHTML = activeFilters.map(filter => `
                    <span class="filter-badge flex items-center">
                        ${filter.label}
                        <button class="ml-2 hover:bg-white hover:bg-opacity-20 rounded-full p-1" onclick="(${filter.remove})()">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </span>
                `).join('');
            } else {
                activeFiltersContainer.classList.add('hidden');
                activeFiltersCount.classList.add('hidden');
                activeFiltersList.innerHTML = '';
            }
        }

        // Load filter counts
        async function loadFilterCounts() {
            try {
                const response = await fetch('/api/analytics/filter-counts');
                const data = await response.json();

                if (data.success) {
                    Object.entries(data.data.diagnostic_counts).forEach(([diagnostic, count]) => {
                        const countElement = document.getElementById(`count-${diagnostic}`);
                        if (countElement) {
                            countElement.textContent = count;
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading filter counts:', error);
            }
        }

        // Preview filters function
        async function previewFiltersFunction() {
            const filters = getFilterValues();

            try {
                const response = await fetch('/api/analytics/filter-preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(filters)
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('filterResultsPreview').textContent =
                        `Aperçu: ${data.data.count} résultats trouvés`;
                }
            } catch (error) {
                console.error('Error previewing filters:', error);
            }
        }

        // Reset filters function
        function resetFiltersFunction() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.querySelectorAll('.diagnostic-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('minConfidence').value = 0;
            document.getElementById('maxConfidence').value = 100;
            document.getElementById('maxProcessingTime').value = 10;
            document.getElementById('minConfidenceValue').textContent = '0%';
            document.getElementById('maxConfidenceValue').textContent = '100%';
            document.getElementById('maxTimeValue').textContent = '10s';
            document.getElementById('filterResultsPreview').textContent = 'Filtres réinitialisés';
            updateActiveFilters();
        }

        // Get filter values
        function getFilterValues() {
            return {
                start_date: document.getElementById('startDate').value,
                end_date: document.getElementById('endDate').value,
                diagnostic_types: Array.from(document.querySelectorAll('.diagnostic-checkbox:checked')).map(cb => cb.value),
                min_confidence: parseInt(document.getElementById('minConfidence').value),
                max_confidence: parseInt(document.getElementById('maxConfidence').value),
                max_processing_time: parseFloat(document.getElementById('maxProcessingTime').value)
            };
        }

        // Apply filters function
        async function applyFiltersFunction() {
            const filters = getFilterValues();

            try {
                const response = await fetch('/api/analytics/filtered', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(filters)
                });

                const data = await response.json();

                if (data.success) {
                    updateFilteredResults(data.data);
                    document.getElementById('filterResultsPreview').textContent =
                        `${data.data.analyses.length} résultats affichés`;
                }
            } catch (error) {
                console.error('Error applying filters:', error);
            }
        }

        function updateFilteredResults(data) {
            const tbody = document.getElementById('filteredAnalysesTable');
            const countSpan = document.getElementById('filteredCount');
            
            countSpan.textContent = `${data.analyses.length} résultats`;
            tbody.innerHTML = '';

            data.analyses.forEach(analysis => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${new Date(analysis.timestamp).toLocaleString('fr-FR')}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${analysis.filename}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getBadgeClass(analysis.predicted_label)}">
                            ${analysis.predicted_label}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="flex items-center">
                            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${analysis.confidence}%"></div>
                            </div>
                            ${analysis.confidence}%
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${analysis.processing_time}s
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs truncate">
                        ${analysis.description}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getBadgeClass(label) {
            const classes = {
                'Normal': 'bg-green-100 text-green-800',
                'Gliome': 'bg-red-100 text-red-800',
                'Méningiome': 'bg-yellow-100 text-yellow-800',
                'Tumeur pituitaire': 'bg-purple-100 text-purple-800'
            };
            return classes[label] || 'bg-gray-100 text-gray-800';
        }

        // Load advanced analytics
        async function loadAdvancedAnalytics() {
            try {
                // Charger toutes les analyses avancées en parallèle
                const [
                    diagnosticResponse,
                    hourlyResponse,
                    confidenceResponse,
                    processingResponse,
                    monthlyResponse
                ] = await Promise.all([
                    fetch('/api/analytics/diagnostic-distribution'),
                    fetch('/api/analytics/hourly-activity'),
                    fetch('/api/analytics/confidence-distribution'),
                    fetch('/api/analytics/processing-time-analysis'),
                    fetch('/api/analytics/monthly-trends')
                ]);

                const diagnosticData = await diagnosticResponse.json();
                const hourlyData = await hourlyResponse.json();
                const confidenceData = await confidenceResponse.json();
                const processingData = await processingResponse.json();
                const monthlyData = await monthlyResponse.json();

                if (diagnosticData.success) updateDiagnosticDistribution(diagnosticData.data);
                if (hourlyData.success) updateHourlyActivity(hourlyData.data);
                if (confidenceData.success) updateConfidenceDistribution(confidenceData.data);
                if (processingData.success) updateProcessingTimeAnalysis(processingData.data);
                if (monthlyData.success) updateMonthlyTrends(monthlyData.data);

            } catch (error) {
                console.error('Error loading advanced analytics:', error);
            }
        }

        // Update diagnostic distribution chart
        function updateDiagnosticDistribution(data) {
            const ctx = document.getElementById('diagnosticDistributionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.counts,
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',   // Vert pour Normal
                            'rgba(239, 68, 68, 0.8)',   // Rouge pour Gliome
                            'rgba(245, 158, 11, 0.8)',  // Jaune pour Méningiome
                            'rgba(147, 51, 234, 0.8)'   // Violet pour Tumeur pituitaire
                        ],
                        borderColor: [
                            'rgb(34, 197, 94)',
                            'rgb(239, 68, 68)',
                            'rgb(245, 158, 11)',
                            'rgb(147, 51, 234)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = data.percentages[context.dataIndex];
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Mettre à jour les compteurs
            const counts = ['normalCount', 'gliomeCount', 'meningiomeCount', 'pituitaireCount'];
            data.labels.forEach((label, index) => {
                const elementId = counts[index];
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = `${data.counts[index]} (${data.percentages[index]}%)`;
                }
            });
        }

        // Update hourly activity heatmap
        function updateHourlyActivity(data) {
            const ctx = document.getElementById('hourlyHeatmapChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i.toString().padStart(2, '0')}h`),
                    datasets: [{
                        label: 'Analyses par heure',
                        data: data.hourly_activity,
                        backgroundColor: data.hourly_activity.map(value => {
                            const intensity = Math.min(value / Math.max(...data.hourly_activity), 1);
                            return `rgba(59, 130, 246, ${0.3 + intensity * 0.7})`;
                        }),
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Mettre à jour les statistiques
            document.getElementById('peakHour').textContent = `${data.peak_hour.toString().padStart(2, '0')}h`;
            document.getElementById('maxHourlyAnalyses').textContent = data.max_hourly_analyses;
            document.getElementById('quietHour').textContent = `${data.quiet_hour.toString().padStart(2, '0')}h`;
        }

        // Update confidence distribution
        function updateConfidenceDistribution(data) {
            const ctx = document.getElementById('confidenceHistogramChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 11}, (_, i) => `${i*10}-${(i+1)*10}%`),
                    datasets: [{
                        label: 'Nombre d\'analyses',
                        data: data.histogram,
                        backgroundColor: 'rgba(34, 197, 94, 0.6)',
                        borderColor: 'rgb(34, 197, 94)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Mettre à jour les statistiques
            document.getElementById('veryHighConf').textContent = data.intervals.very_high;
            document.getElementById('highConf').textContent = data.intervals.high;
            document.getElementById('mediumConf').textContent = data.intervals.medium;
            document.getElementById('lowConf').textContent = data.intervals.low;
        }

        // Update processing time analysis
        function updateProcessingTimeAnalysis(data) {
            const ctx = document.getElementById('processingTimeChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 20}, (_, i) => `${(i*0.5).toFixed(1)}s`),
                    datasets: [{
                        label: 'Nombre d\'analyses',
                        data: data.histogram,
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderColor: 'rgb(59, 130, 246)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Mettre à jour les statistiques
            document.getElementById('fastProcessing').textContent = data.stats.fast;
            document.getElementById('normalProcessing').textContent = data.stats.normal;
            document.getElementById('slowProcessing').textContent = data.stats.slow;
            document.getElementById('medianTime').textContent = `${data.stats.median}s`;
        }

        // Update monthly trends
        function updateMonthlyTrends(data) {
            const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Nombre d\'analyses',
                            data: data.counts,
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Confiance moyenne (%)',
                            data: data.confidences,
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Mois'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Nombre d\'analyses'
                            },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Confiance (%)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // Mettre à jour les insights
            document.getElementById('monthlyGrowth').textContent = `${data.growth_rate > 0 ? '+' : ''}${data.growth_rate}%`;
            document.getElementById('mostActiveMonth').textContent = data.most_active_month;
        }

        // Load AI Insights
        async function loadAIInsights() {
            try {
                const response = await fetch('/api/analytics/ai-insights');
                const data = await response.json();

                if (data.success) {
                    updateAIInsights(data.data);
                }
            } catch (error) {
                console.error('Error loading AI insights:', error);
            }
        }

        // Update AI insights display
        function updateAIInsights(data) {
            // Update performance insights
            const performanceContainer = document.getElementById('performanceInsights');
            performanceContainer.innerHTML = '';
            
            if (data.performance_insights.length === 0) {
                performanceContainer.innerHTML = `
                    <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                        <div class="flex items-center text-sm">
                            <i class="fas fa-circle text-blue-500 text-xs mr-2"></i>
                            <span class="text-gray-700">Performance stable</span>
                        </div>
                    </div>
                `;
            } else {
                data.performance_insights.forEach(insight => {
                    const iconClass = insight.type === 'positive' ? 'fas fa-arrow-up text-green-500' : 
                                    insight.type === 'warning' ? 'fas fa-exclamation-triangle text-yellow-500' :
                                    'fas fa-info-circle text-blue-500';
                    
                    performanceContainer.innerHTML += `
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="${iconClass} text-xs mr-2"></i>
                                <span class="text-gray-700">${insight.message}</span>
                            </div>
                        </div>
                    `;
                });
            }

            // Update quality insights
            const qualityContainer = document.getElementById('qualityInsights');
            qualityContainer.innerHTML = '';
            
            if (data.quality_insights.length === 0) {
                qualityContainer.innerHTML = `
                    <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                        <div class="flex items-center text-sm">
                            <i class="fas fa-circle text-green-500 text-xs mr-2"></i>
                            <span class="text-gray-700">Qualité optimale</span>
                        </div>
                    </div>
                `;
            } else {
                data.quality_insights.forEach(insight => {
                    const iconClass = insight.type === 'warning' ? 'fas fa-exclamation-triangle text-yellow-500' :
                                    'fas fa-info-circle text-green-500';
                    
                    qualityContainer.innerHTML += `
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="${iconClass} text-xs mr-2"></i>
                                <span class="text-gray-700">${insight.message}</span>
                            </div>
                        </div>
                    `;
                });
            }

            // Update recommendations
            const recommendationsContainer = document.getElementById('recommendationsInsights');
            recommendationsContainer.innerHTML = '';
            
            if (data.recommendations.length === 0) {
                recommendationsContainer.innerHTML = `
                    <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                        <div class="flex items-center text-sm">
                            <i class="fas fa-circle text-purple-500 text-xs mr-2"></i>
                            <span class="text-gray-700">Système optimisé</span>
                        </div>
                    </div>
                `;
            } else {
                data.recommendations.forEach(recommendation => {
                    const iconClass = recommendation.type === 'optimization' ? 'fas fa-cog text-orange-500' :
                                    recommendation.type === 'model_improvement' ? 'fas fa-brain text-purple-500' :
                                    'fas fa-chart-line text-purple-500';
                    
                    recommendationsContainer.innerHTML += `
                        <div class="bg-white bg-opacity-60 p-3 rounded-lg">
                            <div class="flex items-center text-sm">
                                <i class="${iconClass} text-xs mr-2"></i>
                                <span class="text-gray-700">${recommendation.message}</span>
                            </div>
                        </div>
                    `;
                });
            }

            // Update scores
            document.getElementById('accuracyScore').textContent = data.scores.accuracy + '%';
            document.getElementById('efficiencyScore').textContent = data.scores.efficiency + '%';
            document.getElementById('reliabilityScore').textContent = data.scores.reliability + '%';
            document.getElementById('overallScore').textContent = data.scores.overall + '%';
        }

        // Refresh insights
        function refreshInsights() {
            showNotification('Actualisation des insights...', 'info');
            loadAIInsights();
        }

        // Export insights
        function exportInsights() {
            window.location.href = '/api/analytics/export/insights-pdf';
            showNotification('Export du rapport d\'insights...', 'info');
        }

        // Export functions for new charts
        function exportDiagnosticData() {
            window.location.href = '/api/analytics/export/diagnostic-csv';
            showNotification('Export diagnostic en cours...', 'info');
        }

        function changeHeatmapView(view) {
            // Changer la vue du heatmap (aujourd'hui vs 7 jours)
            showNotification(`Vue ${view === 'today' ? 'aujourd\'hui' : '7 jours'} sélectionnée`, 'info');
            // Recharger les données avec le nouveau paramètre
            loadAdvancedAnalytics();
        }

        // Load advanced metrics
        async function loadAdvancedMetrics() {
            try {
                const response = await fetch('/api/analytics/advanced-metrics');
                const data = await response.json();

                if (data.success) {
                    updateAdvancedMetrics(data.data);
                    updateYearComparison(data.data.yearly_data);
                }
            } catch (error) {
                console.error('Error loading advanced metrics:', error);
            }
        }

        // Update advanced metrics display
        function updateAdvancedMetrics(data) {
            // Update KPI values
            document.getElementById('throughputRate').textContent = data.throughput_rate;
            document.getElementById('throughputChange').textContent = `${data.throughput_change > 0 ? '+' : ''}${data.throughput_change}%`;
            document.getElementById('accuracyRate').textContent = data.accuracy_rate + '%';
            document.getElementById('avgResponseTime').textContent = data.avg_response_time + 's';
            document.getElementById('systemUptime').textContent = data.system_uptime + '%';

            // Update year comparison metrics
            document.getElementById('yearGrowth').textContent = `${data.year_growth > 0 ? '+' : ''}${data.year_growth}%`;
            document.getElementById('nextMonthPrediction').textContent = data.next_month_prediction;
            document.getElementById('trendDirection').textContent = data.trend_direction;

            // Update response time status
            const responseTimeStatus = document.getElementById('responseTimeStatus');
            if (data.avg_response_time < 2) {
                responseTimeStatus.textContent = 'Excellent';
                responseTimeStatus.className = 'text-green-600 font-medium';
            } else if (data.avg_response_time < 4) {
                responseTimeStatus.textContent = 'Bon';
                responseTimeStatus.className = 'text-blue-600 font-medium';
            } else {
                responseTimeStatus.textContent = 'À améliorer';
                responseTimeStatus.className = 'text-orange-600 font-medium';
            }

            // Update progress bars (simulation)
            const systemLoad = Math.min(Math.max(data.avg_response_time * 10, 20), 80);
            document.getElementById('systemLoad').textContent = systemLoad.toFixed(0) + '%';
            document.getElementById('systemLoadBar').style.width = systemLoad + '%';

            const modelUsage = Math.min(Math.max(data.throughput_rate * 5, 40), 90);
            document.getElementById('modelUsage').textContent = modelUsage.toFixed(0) + '%';
            document.getElementById('modelUsageBar').style.width = modelUsage + '%';

            // Change progress bar colors based on load
            const loadBar = document.getElementById('systemLoadBar');
            if (systemLoad < 50) {
                loadBar.className = 'bg-green-500 h-2 rounded-full';
            } else if (systemLoad < 75) {
                loadBar.className = 'bg-yellow-500 h-2 rounded-full';
            } else {
                loadBar.className = 'bg-red-500 h-2 rounded-full';
            }
        }

        // Update year comparison chart
        function updateYearComparison(yearlyData) {
            const ctx = document.getElementById('yearComparisonChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: yearlyData.labels,
                    datasets: [{
                        label: 'Analyses par mois',
                        data: yearlyData.counts,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: 'white',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Mois',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Nombre d\'analyses',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Toggle year comparison view
        function toggleYearComparison() {
            showNotification('Actualisation de la comparaison annuelle...', 'info');
            loadAdvancedMetrics();
        }

        // Nouvelles fonctions pour les fonctionnalités modernes
        function exportFilteredResults() {
            // Exporter les résultats filtrés
            const filteredData = getCurrentFilteredData();
            if (filteredData.length === 0) {
                showNotification('Aucune donnée à exporter', 'warning');
                return;
            }

            // Créer et télécharger le CSV
            const csv = convertToCSV(filteredData);
            downloadCSV(csv, 'analyses_filtrees.csv');
            showNotification('Export réussi', 'success');
        }

        function refreshFilteredResults() {
            // Actualiser les résultats filtrés
            showNotification('Actualisation en cours...', 'info');
            applyFiltersFunction();
        }

        function exportToPDF() {
            // Générer un rapport PDF
            window.location.href = '/api/analytics/export/pdf';
        }

        function convertToCSV(data) {
            const headers = ['Date/Heure', 'Fichier', 'Diagnostic', 'Confiance', 'Temps', 'Description'];
            const csvContent = [
                headers.join(','),
                ...data.map(row => [
                    row.timestamp,
                    row.filename,
                    row.predicted_label,
                    row.confidence + '%',
                    row.processing_time + 's',
                    row.description || ''
                ].join(','))
            ].join('\n');

            return csvContent;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function getCurrentFilteredData() {
            // Retourner les données actuellement filtrées
            // Cette fonction devrait être implémentée selon la logique de filtrage
            return [];
        }

        // Fonction de notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;

            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            notification.className += ` ${bgColor} text-white`;

            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : type === 'warning' ? 'exclamation' : 'info'} mr-2"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(notification);

            // Animation d'entrée
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            // Auto-suppression après 5 secondes
            setTimeout(() => {
                notification.style.transform = 'translateX(full)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Initialisation des animations
        document.addEventListener('DOMContentLoaded', function() {
            // Animation d'entrée pour les éléments
            const animatedElements = document.querySelectorAll('.fade-in-up, .slide-in-right');
            animatedElements.forEach((el, index) => {
                el.style.opacity = '0';
                el.style.transform = el.classList.contains('fade-in-up') ? 'translateY(30px)' : 'translateX(30px)';

                setTimeout(() => {
                    el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    el.style.opacity = '1';
                    el.style.transform = 'translate(0, 0)';
                }, index * 100);
            });

            // Gestion des boutons de période
            document.querySelectorAll('.comparison-period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.comparison-period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Afficher le loader
                    const loader = document.getElementById('comparisonChartLoader');
                    if (loader) loader.classList.remove('hidden');

                    // Simuler le chargement des données
                    setTimeout(() => {
                        if (loader) loader.classList.add('hidden');
                        showNotification(`Période ${this.textContent.trim()} sélectionnée`, 'success');
                    }, 1000);
                });
            });

            // Notification de bienvenue
            setTimeout(() => {
                showNotification('Tableau de bord avancé chargé avec succès', 'success');
            }, 1000);

            // Initialiser les interactions de la navbar
            initializeNavbar();
        });

        // Initialize navbar interactions
        function initializeNavbar() {
            // User menu dropdown
            const userMenuButton = document.getElementById('userMenuButton');
            const userMenuDropdown = document.getElementById('userMenuDropdown');
            
            userMenuButton?.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenuDropdown.classList.toggle('hidden');
                // Fermer le menu des alertes s'il est ouvert
                document.getElementById('alertsDropdown')?.classList.add('hidden');
            });

            // Alerts dropdown
            const alertsButton = document.getElementById('alertsButton');
            const alertsDropdown = document.getElementById('alertsDropdown');
            
            alertsButton?.addEventListener('click', (e) => {
                e.stopPropagation();
                alertsDropdown.classList.toggle('hidden');
                // Fermer le menu utilisateur s'il est ouvert
                userMenuDropdown?.classList.add('hidden');
                
                // Charger les alertes si le dropdown est ouvert
                if (!alertsDropdown.classList.contains('hidden')) {
                    loadNavbarAlerts();
                }
            });

            // Export menu dropdown (déjà existant, mais on s'assure de la cohérence)
            const exportBtn = document.getElementById('exportBtn');
            const exportMenu = document.getElementById('exportMenu');
            
            exportBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                exportMenu.classList.toggle('hidden');
                // Fermer les autres menus
                userMenuDropdown?.classList.add('hidden');
                alertsDropdown?.classList.add('hidden');
            });

            // Fermer tous les dropdowns en cliquant ailleurs
            document.addEventListener('click', () => {
                userMenuDropdown?.classList.add('hidden');
                alertsDropdown?.classList.add('hidden');
                exportMenu?.classList.add('hidden');
            });
        }

        // Load navbar alerts
        async function loadNavbarAlerts() {
            try {
                const response = await fetch('/api/analytics/alerts');
                const data = await response.json();
                
                if (data.success) {
                    updateNavbarAlerts(data.data);
                }
            } catch (error) {
                console.error('Error loading navbar alerts:', error);
            }
        }

        // Update navbar alerts display
        function updateNavbarAlerts(alerts) {
            const alertsList = document.getElementById('alertsList');
            const alertsBadge = document.getElementById('alertsBadge');
            
            // Mettre à jour le badge
            if (alerts.length > 0) {
                alertsBadge.classList.remove('hidden');
                alertsBadge.textContent = alerts.length;
            } else {
                alertsBadge.classList.add('hidden');
            }

            // Mettre à jour la liste des alertes
            alertsList.innerHTML = '';
            
            if (alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <i class="fas fa-check-circle text-green-500 text-2xl mb-2"></i>
                        <p class="text-sm">Aucune alerte système</p>
                    </div>
                `;
                return;
            }

            alerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = 'p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const iconClass = alert.type === 'warning' ? 'fas fa-exclamation-triangle text-yellow-500' : 
                                alert.type === 'info' ? 'fas fa-info-circle text-blue-500' :
                                'fas fa-check-circle text-green-500';
                
                alertElement.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 mt-1">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900 truncate">
                                ${alert.title}
                            </p>
                            <p class="text-sm text-gray-500 mt-1">
                                ${alert.message}
                            </p>
                            <p class="text-xs text-gray-400 mt-2">
                                ${new Date(alert.timestamp).toLocaleString('fr-FR')}
                            </p>
                        </div>
                    </div>
                `;
                
                alertsList.appendChild(alertElement);
            });
        }

        // Clear all alerts
        function clearAllAlerts() {
            document.getElementById('alertsBadge').classList.add('hidden');
            document.getElementById('alertsList').innerHTML = `
                <div class="p-4 text-center text-gray-500">
                    <i class="fas fa-check-circle text-green-500 text-2xl mb-2"></i>
                    <p class="text-sm">Toutes les alertes ont été marquées comme lues</p>
                </div>
            `;
            showNotification('Alertes marquées comme lues', 'success');
        }

        // Profile and settings modals (placeholders)
        function openProfileModal() {
            showNotification('Modal profil à implémenter', 'info');
        }

        function openSettingsModal() {
            showNotification('Modal paramètres à implémenter', 'info');
        }
    </script>
</body>
</html>
