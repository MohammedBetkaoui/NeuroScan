{% extends "base_dashboard.html" %}

{% block title %}Dashboard - NeuroScan{% endblock %}

{% block page_subtitle %}Dashboard Médecin{% endblock %}

{% block page_title %}Bienvenue, Dr. {{ doctor.first_name }}{% endblock %}

{% block page_description %}Accédez à vos outils d'analyse d'imagerie cérébrale et gérez vos patients.{% endblock %}

{% block content %}


<!-- Actions rapides -->
<div class="dashboard-grid cols-4 mb-8">
    <!-- Nouvelle analyse -->
    <div class="dashboard-card clickable p-0 overflow-hidden hover:shadow-2xl transition-all duration-300 hover:scale-105 bg-gradient-to-br from-blue-50 via-white to-indigo-50 border-l-4 border-blue-500" onclick="navigateTo('new_analysis')">
        <div class="p-6">
            <div class="dashboard-card-header mb-4">
                <div class="dashboard-card-icon primary bg-gradient-to-r from-blue-600 to-indigo-600 shadow-lg">
                    <i class="fas fa-brain text-white"></i>
                </div>
                <div>
                    <h3 class="dashboard-card-title text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent">Analyse IA Avancée</h3>
                    <p class="dashboard-card-subtitle text-blue-600 font-medium">Diagnostic neurologique intelligent</p>
                </div>
            </div>
            <div class="dashboard-card-content space-y-3">
                <p class="text-gray-700 text-sm leading-relaxed">
                    Intelligence artificielle de dernière génération pour l'analyse d'imagerie cérébrale avec précision de 99.7%.
                </p>
                <div class="flex items-center space-x-4 text-xs text-gray-600">
                    <span class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-1"></i> DICOM/NIfTI</span>
                    <span class="flex items-center"><i class="fas fa-clock text-blue-500 mr-1"></i> < 30s</span>
                    <span class="flex items-center"><i class="fas fa-shield-alt text-purple-500 mr-1"></i> Sécurisé</span>
                </div>
            </div>
        </div>
        <div class="h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>
    </div>

    <!-- Tableau de bord pro -->
    <div class="dashboard-card clickable p-6" onclick="navigateTo('pro_dashboard')">
        <div class="dashboard-card-header">
            <div class="dashboard-card-icon success">
                <i class="fas fa-chart-bar"></i>
            </div>
            <div>
                <h3 class="dashboard-card-title">Statistiques</h3>
                <p class="dashboard-card-subtitle">Analyses et tendances</p>
            </div>
        </div>
        <div class="dashboard-card-content">
            <p class="text-gray-600 text-sm">
                Consultez les statistiques détaillées de vos analyses et suivez les tendances.
            </p>
        </div>
    </div>

    <!-- Suivi patients -->
    <div class="dashboard-card clickable p-6" onclick="navigateTo('patients_list')">
        <div class="dashboard-card-header">
            <div class="dashboard-card-icon purple">
                <i class="fas fa-users"></i>
            </div>
            <div>
                <h3 class="dashboard-card-title">Mes Patients</h3>
                <p class="dashboard-card-subtitle">Suivi détaillé</p>
            </div>
        </div>
        <div class="dashboard-card-content">
            <p class="text-gray-600 text-sm">
                Accédez à la liste complète de vos patients avec historique et évolution détaillée.
            </p>
        </div>
    </div>

    <!-- Gestion patients -->
    <div class="dashboard-card clickable p-6" onclick="navigateTo('manage_patients_page')">
        <div class="dashboard-card-header">
            <div class="dashboard-card-icon success">
                <i class="fas fa-users-cog"></i>
            </div>
            <div>
                <h3 class="dashboard-card-title">Gestion Patients</h3>
                <p class="dashboard-card-subtitle">CRUD complet</p>
            </div>
        </div>
        <div class="dashboard-card-content">
            <p class="text-gray-600 text-sm">
                Ajouter, modifier, supprimer et gérer toutes les informations de vos patients.
            </p>
        </div>
    </div>

    <!-- Statistiques plateforme -->
    <div class="dashboard-card clickable p-6" onclick="navigateTo('platform_stats')">
        <div class="dashboard-card-header">
            <div class="dashboard-card-icon indigo">
                <i class="fas fa-globe"></i>
            </div>
            <div>
                <h3 class="dashboard-card-title">Stats Plateforme</h3>
                <p class="dashboard-card-subtitle">Vue d'ensemble globale</p>
            </div>
        </div>
        <div class="dashboard-card-content">
            <p class="text-gray-600 text-sm">
                Consultez les statistiques générales de tous les médecins utilisant NeuroScan.
            </p>
        </div>
    </div>
</div>

<!-- Informations du compte -->
<div class="dashboard-card p-6 mb-8">
    <div class="dashboard-card-header">
        <div class="dashboard-card-icon primary">
            <i class="fas fa-user-circle"></i>
        </div>
        <div>
            <h3 class="dashboard-card-title">Informations du compte</h3>
            <p class="dashboard-card-subtitle">Vos données professionnelles</p>
        </div>
    </div>
    <div class="dashboard-card-content">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div>
                    <label class="form-label">Nom complet</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="text-gray-900 font-medium">Dr. {{ doctor.first_name }} {{ doctor.last_name }}</p>
                    </div>
                </div>
                <div>
                    <label class="form-label">Email</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="text-gray-900">{{ doctor.email }}</p>
                    </div>
                </div>
                <div>
                    <label class="form-label">Spécialité</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="text-gray-900">{{ doctor.specialty or 'Non spécifiée' }}</p>
                    </div>
                </div>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="form-label">Établissement</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="text-gray-900">{{ doctor.hospital or 'Non spécifié' }}</p>
                    </div>
                </div>
                <div>
                    <label class="form-label">Numéro RPPS/ADELI</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="text-gray-900">{{ doctor.license_number or 'Non renseigné' }}</p>
                    </div>
                </div>
                <div>
                    <label class="form-label">Statut du compte</label>
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <span class="badge success">
                            <i class="fas fa-check-circle"></i>
                            Compte Actif
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Aide et support -->
<div class="dashboard-card p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200">
    <div class="dashboard-card-header">
        <div class="dashboard-card-icon primary">
            <i class="fas fa-question-circle"></i>
        </div>
        <div class="flex-1">
            <h3 class="dashboard-card-title text-blue-900">Besoin d'aide ?</h3>
            <p class="dashboard-card-subtitle text-blue-700">
                Notre équipe est là pour vous accompagner dans l'utilisation de NeuroScan.
            </p>
        </div>
    </div>
    <div class="dashboard-card-content">
        <div class="flex flex-wrap gap-3">
            <button onclick="openUserGuideModal()" class="btn-dashboard primary">
                <i class="fas fa-book"></i>
                Guide d'utilisation
            </button>
            <button onclick="openSupportModal()" class="btn-dashboard secondary">
                <i class="fas fa-envelope"></i>
                Contacter le support
            </button>
            <a href="tel:+213783962348" class="btn-dashboard success">
                <i class="fas fa-phone"></i>
                Appel direct
            </a>
        </div>
    </div>
</div>

<!-- Modales spécifiques -->

<!-- Modal Guide d'utilisation -->
<div id="userGuideModal" class="modal-overlay hidden">
    <div class="modal-content" style="--modal-width: 900px;">
        <div class="modal-header">
            <h2 class="modal-title">
                <i class="fas fa-book text-neuroscan-600"></i>
                Guide d'utilisation NeuroScan
            </h2>
            <button onclick="closeUserGuideModal()" class="modal-close">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="space-y-8">
                <!-- Section 1: Démarrage -->
                <div class="border-l-4 border-neuroscan-500 pl-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-play-circle text-neuroscan-600 mr-2"></i>1. Démarrage rapide
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <p><strong>Connexion :</strong> Utilisez vos identifiants médicaux pour accéder à votre tableau de bord personnalisé.</p>
                        <p><strong>Navigation :</strong> Le menu principal vous donne accès à toutes les fonctionnalités de NeuroScan.</p>
                    </div>
                </div>

                <!-- Section 2: Analyse d'images -->
                <div class="border-l-4 border-green-500 pl-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-brain text-green-600 mr-2"></i>2. Analyse d'images IRM
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <p><strong>Formats supportés :</strong> JPEG, PNG, DICOM (recommandé pour les IRM)</p>
                        <p><strong>Processus :</strong></p>
                        <ol class="list-decimal list-inside ml-4 space-y-1">
                            <li>Cliquez sur "Nouvelle Analyse" depuis le tableau de bord</li>
                            <li>Sélectionnez votre fichier IRM (glisser-déposer ou parcourir)</li>
                            <li>Renseignez les informations patient (optionnel mais recommandé)</li>
                            <li>Lancez l'analyse en cliquant sur "Analyser"</li>
                            <li>Consultez les résultats détaillés avec probabilités et recommandations</li>
                        </ol>
                    </div>
                </div>

                <!-- Section 3: Gestion des patients -->
                <div class="border-l-4 border-purple-500 pl-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-users text-purple-600 mr-2"></i>3. Gestion des patients
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <p><strong>Ajouter un patient :</strong> Utilisez "Gestion Patients" pour créer des fiches complètes</p>
                        <p><strong>Suivi longitudinal :</strong> Consultez l'évolution des patients dans "Mes Patients"</p>
                        <p><strong>Historique :</strong> Toutes les analyses sont automatiquement liées au dossier patient</p>
                    </div>
                </div>

                <!-- Section 4: Interprétation des résultats -->
                <div class="border-l-4 border-orange-500 pl-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-chart-line text-orange-600 mr-2"></i>4. Interprétation des résultats
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <p><strong>Classes de diagnostic :</strong></p>
                        <ul class="list-disc list-inside ml-4 space-y-1">
                            <li><span class="text-green-600 font-semibold">Pas de tumeur :</span> Tissu cérébral normal</li>
                            <li><span class="text-blue-600 font-semibold">Méningiome :</span> Tumeur généralement bénigne</li>
                            <li><span class="text-yellow-600 font-semibold">Adénome hypophysaire :</span> Tumeur de l'hypophyse</li>
                            <li><span class="text-red-600 font-semibold">Gliome :</span> Tumeur du tissu glial, nécessite attention</li>
                        </ul>
                        <p><strong>Niveau de confiance :</strong> Indique la certitude du modèle IA (>90% = très fiable)</p>
                    </div>
                </div>

                <!-- Section 5: Bonnes pratiques -->
                <div class="border-l-4 border-red-500 pl-6">
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>5. Bonnes pratiques et limitations
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        <p><strong>⚠️ Important :</strong> NeuroScan est un outil d'aide au diagnostic, pas un remplacement du jugement médical</p>
                        <p><strong>Qualité d'image :</strong> Utilisez des IRM de haute qualité pour de meilleurs résultats</p>
                        <p><strong>Validation :</strong> Toujours corréler avec l'examen clinique et d'autres examens</p>
                        <p><strong>Confidentialité :</strong> Toutes les données sont chiffrées et sécurisées</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <p class="text-sm text-gray-600">
                <i class="fas fa-info-circle mr-1"></i>
                Pour plus d'informations, contactez notre support technique
            </p>
            <button onclick="closeUserGuideModal()" class="btn-dashboard primary">
                Fermer
            </button>
        </div>
    </div>
</div>

<!-- Modal Support -->
<div id="supportModal" class="modal-overlay hidden">
    <div class="modal-content" style="--modal-width: 700px;">
        <div class="modal-header">
            <h2 class="modal-title">
                <i class="fas fa-headset text-green-600"></i>
                Contacter le Support
            </h2>
            <button onclick="closeSupportModal()" class="modal-close">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="space-y-6">
                <!-- Informations de contact -->
                <div class="dashboard-card p-4 bg-green-50 border-green-200">
                    <h3 class="text-lg font-semibold text-green-900 mb-3">
                        <i class="fas fa-user-tie mr-2"></i>Support Technique NeuroScan
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <i class="fas fa-envelope text-green-600 w-5 mr-3"></i>
                            <div>
                                <p class="font-medium text-gray-900">Email</p>
                                <a href="mailto:mohammed.betkaoui@univ-bba.dz" class="text-green-600 hover:text-green-800 underline">
                                    mohammed.betkaoui@univ-bba.dz
                                </a>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-phone text-green-600 w-5 mr-3"></i>
                            <div>
                                <p class="font-medium text-gray-900">Téléphone</p>
                                <a href="tel:+213783962348" class="text-green-600 hover:text-green-800 underline">
                                    +213 783 962 348
                                </a>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-green-600 w-5 mr-3"></i>
                            <div>
                                <p class="font-medium text-gray-900">Horaires</p>
                                <p class="text-gray-700">Lundi - Vendredi : 8h00 - 18h00</p>
                                <p class="text-gray-700">Urgences : 24h/24</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Types de support -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="dashboard-card p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">
                            <i class="fas fa-cogs text-neuroscan-600 mr-2"></i>Support Technique
                        </h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>• Problèmes de connexion</li>
                            <li>• Erreurs d'analyse</li>
                            <li>• Questions techniques</li>
                        </ul>
                    </div>
                    <div class="dashboard-card p-4">
                        <h4 class="font-semibold text-gray-900 mb-2">
                            <i class="fas fa-graduation-cap text-purple-600 mr-2"></i>Formation
                        </h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>• Utilisation de la plateforme</li>
                            <li>• Interprétation des résultats</li>
                            <li>• Bonnes pratiques</li>
                        </ul>
                    </div>
                </div>

                <!-- Formulaire de contact rapide -->
                <div class="dashboard-card p-4">
                    <h4 class="font-semibold text-gray-900 mb-3">
                        <i class="fas fa-paper-plane text-neuroscan-600 mr-2"></i>Message rapide
                    </h4>
                    <form id="supportForm" class="space-y-3">
                        <div class="form-group">
                            <label class="form-label">Sujet</label>
                            <select class="form-select">
                                <option>Support technique</option>
                                <option>Question sur l'interprétation</option>
                                <option>Demande de formation</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea class="form-textarea" placeholder="Décrivez votre demande..."></textarea>
                        </div>
                        <button type="button" onclick="sendSupportMessage()" class="btn-dashboard success w-full justify-center">
                            <i class="fas fa-envelope"></i>
                            Envoyer par email
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <p class="text-sm text-gray-600">
                <i class="fas fa-shield-alt mr-1"></i>
                Toutes les communications sont sécurisées et confidentielles
            </p>
            <button onclick="closeSupportModal()" class="btn-dashboard secondary">
                Fermer
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Navigation helper function
    function navigateTo(routeName) {
        const routes = {
            'pro_dashboard': '{{ url_for("pro_dashboard") }}',
            'patients_list': '{{ url_for("patients_list") }}',
            'manage_patients_page': '{{ url_for("manage_patients_page") }}',
            'platform_stats': '{{ url_for("platform_stats") }}',
            'new_analysis': '{{ url_for("new_analysis_page") }}'
        };
        
        if (routes[routeName]) {
            window.location.href = routes[routeName];
        }
    }

    // Fonctions spécifiques au dashboard

    function openUserGuideModal() {
        document.getElementById('userGuideModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeUserGuideModal() {
        document.getElementById('userGuideModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function openSupportModal() {
        document.getElementById('supportModal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeSupportModal() {
        document.getElementById('supportModal').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function sendSupportMessage() {
        const form = document.getElementById('supportForm');
        const subject = form.querySelector('select').value;
        const message = form.querySelector('textarea').value;

        if (!message.trim()) {
            showNotification('Veuillez saisir votre message', 'warning');
            return;
        }

        // Créer le lien mailto avec les informations
        const emailBody = `Sujet: ${subject}\n\nMessage:\n${message}\n\n---\nEnvoyé depuis NeuroScan Dashboard\nMédecin: Dr. ${currentDoctor.name}\nEmail: ${currentDoctor.email}`;
        const mailtoLink = `mailto:mohammed.betkaoui@univ-bba.dz?subject=Support NeuroScan - ${subject}&body=${encodeURIComponent(emailBody)}`;

        // Ouvrir le client email
        window.location.href = mailtoLink;

        // Fermer le modal après un court délai
        setTimeout(() => {
            closeSupportModal();
            // Réinitialiser le formulaire
            form.querySelector('textarea').value = '';
            showNotification('Email de support ouvert dans votre client de messagerie', 'success');
        }, 1000);
    }
</script>
{% endblock %}
