{% extends "base_dashboard.html" %}

{% block title %}Nouvelle Analyse - NeuroScan{% endblock %}
{% block page_title %}Analyse IA NeuroScan{% endblock %}
{% block page_subtitle %}Interface épurée et performante{% endblock %}
{% block page_description %}Téléversez une imagerie et obtenez un diagnostic IA fiable en quelques secondes.{% endblock %}

{% block extra_css %}
<style>
/* Ultra-Modern Alert Styles for NeuroScan Professional Platform */
:root {
    --alert-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --alert-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    --alert-warning: linear-gradient(135deg, #fcb045 0%, #fd1d1d 100%);
    --alert-error: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    --alert-info: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: rgba(255, 255, 255, 0.3);
    --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.15);
    --border-radius: 20px;
    --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-alert {
    background: var(--glass-bg);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 1.25rem 1.5rem;
    margin-bottom: 0.75rem;
    box-shadow: var(--shadow-soft);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateX(100%) scale(0.95);
    animation: slideInAlert 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    max-width: 420px;
    z-index: 1000;
}

.modern-alert::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 6px;
    height: 100%;
    background: var(--alert-info);
    transition: var(--transition);
    border-radius: var(--border-radius) 0 0 var(--border-radius);
    z-index: -1;
}

.modern-alert::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
    opacity: 0;
    transition: var(--transition);
    border-radius: var(--border-radius);
    z-index: -1;
}

.modern-alert:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: var(--shadow-hover);
    border-color: rgba(255, 255, 255, 0.5);
}

.modern-alert:hover::after {
    opacity: 1;
}

/* Alert Types */
.modern-alert.success {
    border-left: 6px solid #11998e;
}

.modern-alert.success::before {
    background: var(--alert-success);
}

.modern-alert.error {
    border-left: 6px solid #ee5a52;
}

.modern-alert.error::before {
    background: var(--alert-error);
}

.modern-alert.warning {
    border-left: 6px solid #fcb045;
}

.modern-alert.warning::before {
    background: var(--alert-warning);
}

.modern-alert.info {
    border-left: 6px solid #667eea;
}

.modern-alert.info::before {
    background: var(--alert-info);
}

/* Alert Content */
.modern-alert-content {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    position: relative;
    z-index: 2;
}

.modern-alert-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 0.125rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
}

.modern-alert.success .modern-alert-icon {
    background: var(--alert-success);
    box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
}

.modern-alert.error .modern-alert-icon {
    background: var(--alert-error);
    box-shadow: 0 4px 12px rgba(238, 90, 82, 0.3);
}

.modern-alert.warning .modern-alert-icon {
    background: var(--alert-warning);
    box-shadow: 0 4px 12px rgba(252, 176, 69, 0.3);
}

.modern-alert.info .modern-alert-icon {
    background: var(--alert-info);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.modern-alert-icon i {
    color: white;
    font-size: 12px;
    font-weight: bold;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.modern-alert-text {
    flex: 1;
    font-size: 0.95rem;
    font-weight: 600;
    color: #1f2937;
    line-height: 1.5;
    margin: 0;
}

.modern-alert-description {
    font-size: 0.85rem;
    font-weight: 400;
    color: #6b7280;
    margin-top: 0.25rem;
    line-height: 1.4;
}

.modern-alert-close {
    background: none;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    padding: 0.375rem;
    border-radius: 8px;
    transition: var(--transition);
    flex-shrink: 0;
    margin-top: -0.25rem;
    margin-right: -0.25rem;
}

.modern-alert-close:hover {
    background: rgba(0, 0, 0, 0.05);
    color: #374151;
    transform: scale(1.1);
}

/* Animations */
@keyframes slideInAlert {
    from {
        opacity: 0;
        transform: translateX(100%) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
}

@keyframes fadeOutAlert {
    from {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
    to {
        opacity: 0;
        transform: translateX(100%) scale(0.95);
    }
}

.modern-alert.fade-out {
    animation: fadeOutAlert 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* Pulse animation for important alerts */
@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.modern-alert.important {
    animation: slideInAlert 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards, pulse 2s ease-in-out infinite;
}

/* Progress bar for loading alerts */
.modern-alert-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: var(--alert-info);
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    animation: progressBar 5s linear forwards;
}

@keyframes progressBar {
    from {
        width: 100%;
    }
    to {
        width: 0%;
    }
}

/* Responsive design */
@media (max-width: 640px) {
    .modern-alert {
        max-width: calc(100vw - 2rem);
        margin-left: 1rem;
        margin-right: 1rem;
    }

    .modern-alert-content {
        gap: 0.75rem;
    }

    .modern-alert-text {
        font-size: 0.9rem;
    }
}

/* Additional styles for enhanced alerts */
.modern-alert-body {
    flex: 1;
    min-width: 0;
}

.modern-alert-message {
    font-size: 0.9rem;
    font-weight: 500;
    color: #374151;
    margin-top: 0.5rem;
    line-height: 1.4;
}

.modern-alert-action {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    margin-top: 0.75rem;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.modern-alert-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.modern-alert-action:active {
    transform: translateY(0);
}

/* Enhanced animations */
@keyframes bounceIn {
    0% {
        opacity: 0;
        transform: scale(0.3);
    }
    50% {
        opacity: 1;
        transform: scale(1.05);
    }
    70% {
        transform: scale(0.9);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

.modern-alert.important {
    animation: slideInAlert 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards, bounceIn 0.8s ease-out 0.6s;
}

/* Loading state for alerts */
.modern-alert.loading .modern-alert-icon i {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.modern-alert:hover::after {
    opacity: 1;
}

.modern-alert.success::before {
    background: linear-gradient(135deg, #00b894, #00a085);
}

.modern-alert.error::before {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
}

.modern-alert.warning::before {
    background: linear-gradient(135deg, #ffd93d, #ff9f43);
}

.modern-alert.info::before {
    background: linear-gradient(135deg, #74b9ff, #0984e3);
}

.modern-alert-content {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.modern-alert-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.modern-alert.success .modern-alert-icon {
    background: linear-gradient(135deg, #00b894, #00a085);
}

.modern-alert.error .modern-alert-icon {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
}

.modern-alert.warning .modern-alert-icon {
    background: linear-gradient(135deg, #ffd93d, #ff9f43);
}

.modern-alert.info .modern-alert-icon {
    background: linear-gradient(135deg, #74b9ff, #0984e3);
}

.modern-alert-icon i {
    color: white;
    font-size: 10px;
}

.modern-alert-text {
    flex: 1;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
}

.modern-alert-close {
    background: none;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.modern-alert-close:hover {
    background: rgba(0, 0, 0, 0.05);
    color: #6b7280;
}

@keyframes slideInAlert {
    from {
        opacity: 0;
        transform: translateX(100%);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes fadeOutAlert {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100%);
    }
}

.modern-alert.fade-out {
    animation: fadeOutAlert 0.5s ease-out forwards;
}
</style>
{% endblock %}

{% block content %}
  <div class="min-h-screen bg-neutral-50 -mt-6 pt-6">
    <!-- Modern Alert Container -->
    <div id="modernAlertContainer" class="fixed top-4 right-4 z-50 space-y-2 max-w-sm"></div>

    <div class="max-w-7xl mx-auto p-6">    <!-- Bandeau -->
    <section class="rounded-2xl p-6 bg-white border border-neutral-200 shadow-sm mb-6">
      <div class="flex items-center justify-between gap-4 flex-wrap">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 text-white flex items-center justify-center shadow">
            <i class="fas fa-brain"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-neutral-900">NeuroScan • Nouvelle Analyse</h1>
            <p class="text-neutral-500 text-sm">Sélectionnez un patient, importez une image IRM, lancez l'analyse.</p>
          </div>
        </div>
        <div class="flex items-center gap-3 text-sm text-neutral-600">
          <i class="fas fa-shield-alt text-emerald-600"></i>
          <span>Données chiffrées</span>
          <span class="w-1 h-1 rounded-full bg-neutral-300"></span>
          <i class="fas fa-check-circle text-blue-600"></i>
          <span>Modèle validé</span>
        </div>
      </div>
    </section>

    <!-- Grille principale: Patient | Upload | Statut -->
    <section class="grid grid-cols-1 lg:grid-cols-5 gap-6">
      <!-- Patient (2) -->
      <div class="lg:col-span-2 space-y-6">
        <div class="rounded-2xl p-6 bg-white border border-neutral-200 shadow-sm">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg bg-blue-50 text-blue-700 flex items-center justify-center">
              <i class="fas fa-user-md"></i>
            </div>
            <h2 class="font-semibold text-neutral-900">Patient</h2>
          </div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">Sélectionnez un patient</label>
          <select id="patientSelect" class="w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-800 shadow-inner focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-400">
            <option value="">— Choisir —</option>
            {% for patient in patients %}
            <option value="{{ patient.patient_id }}" 
              data-name="{{ patient.patient_name }}" 
              data-age="{{ patient.age }}"
              data-gender="{{ patient.gender }}"
              data-dob="{{ patient.date_of_birth }}">
              {{ patient.patient_name }} — {{ patient.age }} ans ({{ patient.gender }})
            </option>
            {% endfor %}
          </select>

          <div id="patientInfo" class="hidden mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3">
              <div class="text-xs text-neutral-500">Nom</div>
              <div id="patientName" class="font-semibold text-neutral-800">—</div>
            </div>
            <div class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3">
              <div class="text-xs text-neutral-500">Âge</div>
              <div id="patientAge" class="font-semibold text-neutral-800">—</div>
            </div>
            <div class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3">
              <div class="text-xs text-neutral-500">Sexe</div>
              <div id="patientGender" class="font-semibold text-neutral-800">—</div>
            </div>
            <div class="rounded-xl border border-neutral-200 bg-neutral-50 px-4 py-3">
              <div class="text-xs text-neutral-500">Date de naissance</div>
              <div id="patientDob" class="font-semibold text-neutral-800">—</div>
            </div>
          </div>

          <!-- Date d'examen -->
          <div class="mt-5">
            <label for="nsExamDate" class="block text-sm font-medium text-neutral-700 mb-2">Date d'examen</label>
            <input id="nsExamDate" type="date" class="w-full sm:w-auto rounded-xl border border-neutral-300 bg-white px-4 py-2 text-neutral-800 shadow-inner focus:outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-400" />
          </div>
        </div>
      </div>

      <!-- Upload (2) -->
      <div class="lg:col-span-2 space-y-6">
        <div class="rounded-2xl p-6 bg-white border border-neutral-200 shadow-sm">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg bg-indigo-50 text-indigo-700 flex items-center justify-center">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <h2 class="font-semibold text-neutral-900">Téléversement</h2>
          </div>

          <div id="nsDropZone" class="rounded-2xl border-2 border-dashed border-neutral-300 bg-neutral-50 hover:bg-neutral-100 transition p-10 text-center cursor-pointer">
            <div class="mx-auto w-16 h-16 rounded-full bg-neutral-200 text-neutral-600 flex items-center justify-center mb-4">
              <i class="fas fa-file-medical"></i>
            </div>
            <p class="font-semibold text-neutral-800">Déposez votre image IRM ici</p>
            <p class="text-sm text-neutral-500">ou cliquez pour parcourir • JPG, PNG, DICOM (max 50MB)</p>
            <input id="nsFileInput" type="file" class="hidden" accept=".jpg,.jpeg,.png,.dcm,.dicom,.nii">
          </div>

          <div id="nsFileInfo" class="hidden mt-5 rounded-xl bg-neutral-50 border border-neutral-200 p-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-emerald-500 text-white flex items-center justify-center">
                  <i class="fas fa-check"></i>
                </div>
                <div>
                  <div id="nsFileName" class="font-semibold text-neutral-900"></div>
                  <div id="nsFileSize" class="text-sm text-neutral-500"></div>
                </div>
              </div>
              <div class="w-48 h-2 rounded-full bg-neutral-200 overflow-hidden">
                <div id="nsUploadProgress" class="h-2 bg-gradient-to-r from-emerald-500 to-teal-600" style="width:0%"></div>
              </div>
            </div>
            <img id="nsImagePreview" class="mt-4 w-full h-48 object-contain rounded-lg border border-neutral-200" style="display:none;" alt="Aperçu de l'image" />
          </div>

          <button id="nsAnalyzeBtn" class="mt-6 w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 shadow-sm hover:shadow focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Lancer l'analyse IA
          </button>
        </div>
      </div>

      <!-- Statut (1) -->
      <div class="lg:col-span-1 space-y-6">
        <div id="nsProgressCard" class="fixed inset-0 hidden items-center justify-center bg-black/60 backdrop-blur-sm z-50">
          <div class="bg-white rounded-3xl p-10 shadow-2xl max-w-lg w-full mx-4 border border-neutral-200">
            <div class="text-center">
              <div class="relative mb-6">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mx-auto shadow-lg">
                  <i class="fas fa-brain text-white text-3xl animate-pulse"></i>
                </div>
                <div class="absolute -top-2 -right-2 w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center">
                  <i class="fas fa-cogs text-white text-sm animate-spin"></i>
                </div>
              </div>
              <h2 class="text-2xl font-bold text-neutral-900 mb-2">Analyse IA en cours</h2>
              <p class="text-neutral-600 mb-6" id="nsStatusText">Préparation de l'analyse...</p>

              <!-- Patient Info -->
              <div class="bg-neutral-50 rounded-xl p-4 mb-4">
                <div class="flex items-center justify-center gap-3 text-sm">
                  <i class="fas fa-user-md text-blue-600"></i>
                  <span class="font-medium text-neutral-800" id="progressPatientName">Patient</span>
                  <span class="text-neutral-500">•</span>
                  <span id="progressPatientAge">Âge</span>
                  <span class="text-neutral-500">•</span>
                  <span id="progressPatientGender">Genre</span>
                </div>
              </div>

              <!-- File Info -->
              <div class="bg-neutral-50 rounded-xl p-4 mb-6">
                <div class="flex items-center justify-center gap-3 text-sm">
                  <i class="fas fa-file-medical text-indigo-600"></i>
                  <span class="font-medium text-neutral-800" id="progressFileName">Fichier</span>
                  <span class="text-neutral-500">•</span>
                  <span id="progressFileSize">Taille</span>
                </div>
              </div>

              <div class="w-full h-4 rounded-full bg-neutral-200 overflow-hidden mb-3 shadow-inner">
                <div id="nsAnalysisProgress" class="h-4 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-600 transition-all duration-500 ease-out" style="width:0%"></div>
              </div>
              <div class="text-center text-lg font-semibold text-neutral-700 mb-2" id="nsProgressPct">0%</div>
              <p class="text-sm text-neutral-500">Veuillez patienter, l'analyse peut prendre quelques secondes...</p>
            </div>
          </div>
        </div>

        <div id="nsResultsCard" class="rounded-2xl p-6 bg-emerald-50 border border-emerald-200 text-emerald-800 shadow-sm hidden cursor-pointer hover:shadow-md transition" onclick="openResultsModal()">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-full bg-emerald-500 text-white flex items-center justify-center shrink-0">
              <i class="fas fa-check text-lg"></i>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <div class="font-semibold">Analyse terminée</div>
                <span id="nsResultMiniBadge" class="px-2 py-1 rounded-md bg-blue-600 text-white text-xs font-semibold">—</span>
              </div>
              <div id="nsResultMiniSummary" class="text-sm opacity-90 truncate">Cliquez pour voir le rapport détaillé</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Modal résultats -->
<div id="resultsModal" class="fixed inset-0 hidden items-start justify-center bg-black/50 overflow-y-hidden p-4 md:p-6" aria-modal="true" role="dialog">
  <div class="modal-content w-full mx-0 md:mx-4 rounded-2xl shadow-2xl bg-white" style="width: min(80vw, 1200px);" onclick="event.stopPropagation()">
    <div class="p-6 border-b border-neutral-200 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-emerald-50 text-emerald-700 flex items-center justify-center">
          <i class="fas fa-file-medical"></i>
        </div>
        <div>
          <div class="text-xl font-bold text-neutral-900">Rapport de Diagnostic IA</div>
          <div class="text-sm text-neutral-500">Généré automatiquement • <span id="modalAnalysisId" class="font-medium text-neutral-700"></span></div>
        </div>
      </div>
      <button id="closeModal" class="rounded-lg px-3 py-2 text-neutral-600 hover:bg-neutral-100">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-6 overflow-y-auto max-h-[80vh]">
      <!-- En-tête patient -->
      <div class="rounded-xl border border-neutral-200 p-4 mb-6 bg-neutral-50">
        <div class="flex flex-wrap items-center gap-3 text-sm">
          <div class="flex items-center gap-2 px-3 py-1 rounded-lg bg-white border border-neutral-200"><i class="fas fa-user text-neutral-600"></i><span id="hdrPatientName" class="font-semibold text-neutral-900">—</span></div>
          <div class="flex items-center gap-2 px-3 py-1 rounded-lg bg-white border border-neutral-200"><i class="fas fa-birthday-cake text-neutral-600"></i><span id="hdrPatientAge">—</span></div>
          <div class="flex items-center gap-2 px-3 py-1 rounded-lg bg-white border border-neutral-200"><i class="fas fa-venus-mars text-neutral-600"></i><span id="hdrPatientGender">—</span></div>
          <div class="flex items-center gap-2 px-3 py-1 rounded-lg bg-white border border-neutral-200"><i class="fas fa-calendar-day text-neutral-600"></i><span id="hdrExamDate">—</span></div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Image IRM -->
        <div class="lg:col-span-5">
          <div class="rounded-xl border border-neutral-200 overflow-hidden bg-black/5 flex items-center justify-center">
            <img id="modalResultImg" class="w-full h-96 object-contain" alt="IRM" />
          </div>
        </div>
        <!-- Informations diagnostic -->
        <div class="lg:col-span-7 space-y-4">
          <div class="flex flex-wrap items-center gap-3">
            <span id="modalDiagBadge" class="px-3 py-1 rounded-lg bg-blue-600 text-white text-sm font-semibold">—</span>
            <div class="text-sm text-neutral-500">Temps d'analyse: <span id="modalProcTime" class="font-semibold text-neutral-800">—</span></div>
          </div>
          <div id="modalPrediction" class="text-3xl font-bold text-neutral-900">—</div>
          <!-- Confiance visuelle -->
          <div>
            <div class="flex items-center justify-between text-sm text-neutral-600 mb-1">
              <span>Niveau de confiance</span>
              <span id="modalConfidence" class="font-semibold text-neutral-900">—</span>
            </div>
            <div class="w-full h-3 rounded-full bg-neutral-200 overflow-hidden">
              <div id="modalConfidenceBar" class="h-3 rounded-full bg-gradient-to-r from-emerald-500 to-teal-600" style="width:0%"></div>
            </div>
          </div>
          <!-- Résumé patient -->
          <div id="modalPatientSummary" class="text-neutral-700">—</div>
        </div>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mt-6">
        <div class="rounded-xl border border-neutral-200 p-4">
          <div class="font-semibold text-neutral-900 mb-3">Scores et Répartition</div>
          <div class="relative h-80 mt-2">
            <canvas id="modalProbChart" class="absolute inset-0 w-full h-full"></canvas>
          </div>
          <div id="modalProbs" class="mt-4 space-y-2"></div>
        </div>
        <div class="rounded-xl border border-neutral-200 p-4">
          <div class="font-semibold text-neutral-900 mb-3">Recommandations</div>
          <ul id="modalRecs" class="space-y-2 text-neutral-700 text-sm"></ul>
        </div>
      </div>

      <div class="flex flex-wrap items-center justify-end gap-3 mt-6">
        <button class="rounded-xl px-4 py-2 bg-neutral-100 text-neutral-800 hover:bg-neutral-200">Historique</button>
        <button id="shareBtn" class="rounded-xl px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-700">Partager</button>
        <button id="reportBtn" class="rounded-xl px-4 py-2 bg-blue-600 text-white hover:bg-blue-700">Télécharger PDF</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
     <script src="/static/js/new_analyse.js"></script>
{% endblock %}
